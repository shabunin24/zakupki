<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü—Ä–æ—Å—Ç–æ–π —Ç–µ—Å—Ç –ø–æ–∏—Å–∫–∞</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f0f0f0;
        }
        .test-container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .success { color: green; font-weight: bold; }
        .error { color: red; font-weight: bold; }
        .warning { color: orange; font-weight: bold; }
        button {
            padding: 10px 15px;
            margin: 5px;
            background: #007AFF;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover { background: #0056b3; }
        input {
            padding: 10px;
            margin: 5px;
            border: 1px solid #ddd;
            border-radius: 5px;
            width: 200px;
        }
        .result {
            margin: 10px 0;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
            border-left: 4px solid #007AFF;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üß™ –ü—Ä–æ—Å—Ç–æ–π —Ç–µ—Å—Ç –ø–æ–∏—Å–∫–∞ –ì–æ—Å–ó–∞–∫—É–ø–∫–∏</h1>
        
        <div class="test-section">
            <h3>1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∫—Ä–∏–ø—Ç–æ–≤</h3>
            <button onclick="testScripts()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–∫—Ä–∏–ø—Ç—ã</button>
            <div id="scriptResult"></div>
        </div>
        
        <div class="test-section">
            <h3>2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ—É–Ω–∫—Ü–∏–π</h3>
            <button onclick="testFunctions()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏</button>
            <div id="functionResult"></div>
        </div>
        
        <div class="test-section">
            <h3>3. –¢–µ—Å—Ç –ø–æ–∏—Å–∫–∞</h3>
            <input type="text" id="searchInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å –¥–ª—è –ø–æ–∏—Å–∫–∞">
            <button onclick="testSearch()">–í—ã–ø–æ–ª–Ω–∏—Ç—å –ø–æ–∏—Å–∫</button>
            <div id="searchResult"></div>
        </div>
        
        <div class="test-section">
            <h3>4. –¢–µ—Å—Ç –∫–Ω–æ–ø–∫–∏ –ø–æ–∏—Å–∫–∞</h3>
            <button onclick="testSearchButton()">–¢–µ—Å—Ç –∫–Ω–æ–ø–∫–∏ –ø–æ–∏—Å–∫–∞</button>
            <div id="buttonResult"></div>
        </div>
        
        <div class="test-section">
            <h3>5. –ö–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞</h3>
            <p>–û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ (F12) –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ø–æ–¥—Ä–æ–±–Ω—ã—Ö –ª–æ–≥–æ–≤</p>
            <button onclick="console.log('–¢–µ—Å—Ç –∫–æ–Ω—Å–æ–ª–∏')">–¢–µ—Å—Ç –∫–æ–Ω—Å–æ–ª–∏</button>
        </div>
    </div>

    <script>
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã–≤–æ–¥–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
        function showResult(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            const className = type === 'success' ? 'success' : type === 'error' ? 'error' : 'warning';
            element.innerHTML = `<div class="result ${className}">${message}</div>`;
        }

        // –¢–µ—Å—Ç –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∫—Ä–∏–ø—Ç–æ–≤
        function testScripts() {
            console.log('–¢–µ—Å—Ç–∏—Ä—É–µ–º –∑–∞–≥—Ä—É–∑–∫—É —Å–∫—Ä–∏–ø—Ç–æ–≤...');
            
            let results = [];
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
            if (typeof mockPurchases !== 'undefined') {
                results.push(`‚úÖ mockPurchases –∑–∞–≥—Ä—É–∂–µ–Ω: ${mockPurchases.length} –∑–∞–ø–∏—Å–µ–π`);
                console.log('mockPurchases:', mockPurchases);
            } else {
                results.push('‚ùå mockPurchases –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
            }
            
            if (typeof favorites !== 'undefined') {
                results.push(`‚úÖ favorites –∑–∞–≥—Ä—É–∂–µ–Ω: ${favorites.length} –∑–∞–ø–∏—Å–µ–π`);
            } else {
                results.push('‚ùå favorites –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
            }
            
            if (typeof searchHistory !== 'undefined') {
                results.push(`‚úÖ searchHistory –∑–∞–≥—Ä—É–∂–µ–Ω: ${searchHistory.length} –∑–∞–ø–∏—Å–µ–π`);
            } else {
                results.push('‚ùå searchHistory –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
            }
            
            showResult('scriptResult', results.join('<br>'), results.every(r => r.includes('‚úÖ')) ? 'success' : 'warning');
        }

        // –¢–µ—Å—Ç —Ñ—É–Ω–∫—Ü–∏–π
        function testFunctions() {
            console.log('–¢–µ—Å—Ç–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏–∏...');
            
            let results = [];
            let availableCount = 0;
            
            const functions = [
                'searchPurchases',
                'performSimpleSearch',
                'showSearchResultsModal',
                'addToFavorites',
                'showPurchaseDetails',
                'formatPrice',
                'formatDate'
            ];
            
            functions.forEach(funcName => {
                if (typeof window[funcName] === 'function') {
                    results.push(`‚úÖ ${funcName} –¥–æ—Å—Ç—É–ø–Ω–∞`);
                    availableCount++;
                } else {
                    results.push(`‚ùå ${funcName} –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞`);
                }
            });
            
            const successRate = availableCount / functions.length;
            const type = successRate === 1 ? 'success' : successRate > 0.5 ? 'warning' : 'error';
            
            results.push(`<br><strong>–î–æ—Å—Ç—É–ø–Ω–æ —Ñ—É–Ω–∫—Ü–∏–π: ${availableCount}/${functions.length} (${Math.round(successRate * 100)}%)</strong>`);
            
            showResult('functionResult', results.join('<br>'), type);
        }

        // –¢–µ—Å—Ç –ø–æ–∏—Å–∫–∞
        function testSearch() {
            console.log('–¢–µ—Å—Ç–∏—Ä—É–µ–º –ø–æ–∏—Å–∫...');
            
            const query = document.getElementById('searchInput').value.trim();
            if (!query) {
                showResult('searchResult', '‚ö†Ô∏è –í–≤–µ–¥–∏—Ç–µ –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å', 'warning');
                return;
            }
            
            try {
                if (typeof searchPurchases !== 'function') {
                    showResult('searchResult', '‚ùå –§—É–Ω–∫—Ü–∏—è searchPurchases –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞', 'error');
                    return;
                }
                
                console.log(`–í—ã–ø–æ–ª–Ω—è–µ–º –ø–æ–∏—Å–∫ –ø–æ –∑–∞–ø—Ä–æ—Å—É: "${query}"`);
                const results = searchPurchases(query);
                
                if (results.length > 0) {
                    let resultHtml = `‚úÖ –ù–∞–π–¥–µ–Ω–æ ${results.length} —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:<br>`;
                    results.forEach((result, index) => {
                        resultHtml += `${index + 1}. ${result.title}<br>`;
                        resultHtml += `   –†–µ–≥–∏–æ–Ω: ${result.region}, –¶–µ–Ω–∞: ${result.price} ${result.currency}<br><br>`;
                    });
                    showResult('searchResult', resultHtml, 'success');
                } else {
                    showResult('searchResult', '‚ö†Ô∏è –ü–æ –∑–∞–ø—Ä–æ—Å—É –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ', 'warning');
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ:', error);
                showResult('searchResult', `‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ: ${error.message}`, 'error');
            }
        }

        // –¢–µ—Å—Ç –∫–Ω–æ–ø–∫–∏ –ø–æ–∏—Å–∫–∞
        function testSearchButton() {
            console.log('–¢–µ—Å—Ç–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É –ø–æ–∏—Å–∫–∞...');
            
            try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –∫–Ω–æ–ø–∫–∞ –ø–æ–∏—Å–∫–∞
                const searchBtn = document.querySelector('.search-btn');
                if (!searchBtn) {
                    showResult('buttonResult', '‚ùå –ö–Ω–æ–ø–∫–∞ –ø–æ–∏—Å–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ DOM', 'error');
                    return;
                }
                
                showResult('buttonResult', '‚úÖ –ö–Ω–æ–ø–∫–∞ –ø–æ–∏—Å–∫–∞ –Ω–∞–π–¥–µ–Ω–∞ –≤ DOM', 'success');
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞
                if (typeof performSimpleSearch === 'function') {
                    showResult('buttonResult', '‚úÖ –§—É–Ω–∫—Ü–∏—è performSimpleSearch –¥–æ—Å—Ç—É–ø–Ω–∞', 'success');
                    
                    // –¢–µ—Å—Ç–∏—Ä—É–µ–º –≤—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏
                    try {
                        // –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—É—é –ø–æ–∏—Å–∫–æ–≤—É—é —Å—Ç—Ä–æ–∫—É –¥–ª—è —Ç–µ—Å—Ç–∞
                        const tempInput = document.createElement('input');
                        tempInput.className = 'search-input';
                        tempInput.value = '—Ç–µ—Å—Ç';
                        document.body.appendChild(tempInput);
                        
                        // –í—ã–∑—ã–≤–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –ø–æ–∏—Å–∫–∞
                        performSimpleSearch();
                        
                        // –£–±–∏—Ä–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç
                        document.body.removeChild(tempInput);
                        
                        showResult('buttonResult', '‚úÖ –§—É–Ω–∫—Ü–∏—è performSimpleSearch –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –±–µ–∑ –æ—à–∏–±–æ–∫', 'success');
                        
                    } catch (funcError) {
                        showResult('buttonResult', `‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ performSimpleSearch: ${funcError.message}`, 'warning');
                    }
                    
                } else {
                    showResult('buttonResult', '‚ùå –§—É–Ω–∫—Ü–∏—è performSimpleSearch –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞', 'error');
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –∫–Ω–æ–ø–∫–∏:', error);
                showResult('buttonResult', `‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏: ${error.message}`, 'error');
            }
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', () => {
            console.log('–°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞, –∑–∞–ø—É—Å–∫–∞–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã...');
            
            // –ñ–¥–µ–º –Ω–µ–º–Ω–æ–≥–æ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∫—Ä–∏–ø—Ç–æ–≤
            setTimeout(() => {
                console.log('–ó–∞–ø—É—Å–∫–∞–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã...');
                testScripts();
                testFunctions();
            }, 1000);
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ Enter –¥–ª—è –ø–æ–∏—Å–∫–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏
        document.getElementById('searchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                testSearch();
            }
        });

        console.log('–ü—Ä–æ—Å—Ç–æ–π —Ç–µ—Å—Ç –ø–æ–∏—Å–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
    </script>
</body>
</html>
