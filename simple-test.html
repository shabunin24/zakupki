<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü—Ä–æ—Å—Ç–æ–π —Ç–µ—Å—Ç –ø–æ–∏—Å–∫–∞</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .test-section { margin: 20px 0; padding: 20px; border: 2px solid #e0e0e0; border-radius: 8px; }
        .result { margin: 10px 0; padding: 15px; background: #f8f9fa; border-radius: 6px; border-left: 4px solid #007AFF; }
        .error { border-left-color: #dc3545; background: #f8d7da; }
        .success { border-left-color: #28a745; background: #d4edda; }
        button { padding: 12px 24px; margin: 8px; background: #007AFF; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 16px; }
        button:hover { background: #0056b3; }
        input, select { padding: 12px; margin: 8px; border: 2px solid #e0e0e0; border-radius: 6px; width: 250px; font-size: 16px; }
        input:focus, select:focus { border-color: #007AFF; outline: none; }
        .search-results { margin-top: 20px; }
        .purchase-item { padding: 15px; margin: 10px 0; background: #f8f9fa; border-radius: 8px; border: 1px solid #e0e0e0; }
        .purchase-title { font-weight: bold; color: #333; margin-bottom: 8px; }
        .purchase-details { color: #666; font-size: 14px; }
        .price { color: #28a745; font-weight: bold; }
        .status { padding: 4px 8px; border-radius: 4px; font-size: 12px; }
        .status.active { background: #d4edda; color: #155724; }
        .status.completed { background: #d1ecf1; color: #0c5460; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç –¢–µ—Å—Ç –ø–æ–∏—Å–∫–∞ –ì–æ—Å–ó–∞–∫—É–ø–∫–∏</h1>
        <p>–≠—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç –æ—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ø–æ–∏—Å–∫–∞ –±–µ–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞.</p>
        
        <div class="test-section">
            <h3>üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö</h3>
            <button onclick="checkData()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É –¥–∞–Ω–Ω—ã—Ö</button>
            <div id="dataResult"></div>
        </div>
        
        <div class="test-section">
            <h3>üîç –ü—Ä–æ—Å—Ç–æ–π –ø–æ–∏—Å–∫</h3>
            <input type="text" id="searchInput" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è –ø–æ–∏—Å–∫–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: –∫–æ–º–ø—å—é—Ç–µ—Ä, —É—Å–ª—É–≥–∏, –º–æ—Å–∫–≤–∞)">
            <button onclick="performSearch()">–í—ã–ø–æ–ª–Ω–∏—Ç—å –ø–æ–∏—Å–∫</button>
            <div id="searchResult"></div>
            <div id="searchResults" class="search-results"></div>
        </div>
        
        <div class="test-section">
            <h3>üéØ –ü–æ–∏—Å–∫ —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏</h3>
            <select id="categoryFilter">
                <option value="">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
                <option value="–¢–æ–≤–∞—Ä—ã">–¢–æ–≤–∞—Ä—ã</option>
                <option value="–£—Å–ª—É–≥–∏">–£—Å–ª—É–≥–∏</option>
                <option value="–†–∞–±–æ—Ç—ã">–†–∞–±–æ—Ç—ã</option>
            </select>
            <select id="regionFilter">
                <option value="">–í—Å–µ —Ä–µ–≥–∏–æ–Ω—ã</option>
                <option value="–ú–æ—Å–∫–≤–∞">–ú–æ—Å–∫–≤–∞</option>
                <option value="–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥">–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥</option>
                <option value="–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫">–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫</option>
            </select>
            <button onclick="performFilteredSearch()">–ü–æ–∏—Å–∫ —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏</button>
            <div id="filteredResult"></div>
            <div id="filteredResults" class="search-results"></div>
        </div>
        
        <div class="test-section">
            <h3>üß™ –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π —Ç–µ—Å—Ç</h3>
            <button onclick="runComprehensiveTest()">–ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã</button>
            <div id="comprehensiveResult"></div>
        </div>
    </div>

    <script>
        // –ò–º–∏—Ç–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –∑–∞–∫—É–ø–æ–∫ (–µ—Å–ª–∏ –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª—Å—è)
        const fallbackPurchases = [
            {
                id: 1,
                title: "–ü–æ—Å—Ç–∞–≤–∫–∞ –∫–æ–º–ø—å—é—Ç–µ—Ä–Ω–æ–π —Ç–µ—Ö–Ω–∏–∫–∏",
                category: "–¢–æ–≤–∞—Ä—ã",
                subcategory: "–≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞",
                region: "–ú–æ—Å–∫–≤–∞",
                price: 2500000,
                status: "active",
                deadline: "2024-12-15",
                description: "–ü–æ—Å—Ç–∞–≤–∫–∞ –∫–æ–º–ø—å—é—Ç–µ—Ä–æ–≤, –Ω–æ—É—Ç–±—É–∫–æ–≤ –∏ –ø–µ—Ä–∏—Ñ–µ—Ä–∏–∏ –¥–ª—è –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —É—á—Ä–µ–∂–¥–µ–Ω–∏—è"
            },
            {
                id: 2,
                title: "–£—Å–ª—É–≥–∏ –ø–æ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–≥–æ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è",
                category: "–£—Å–ª—É–≥–∏",
                subcategory: "IT —É—Å–ª—É–≥–∏",
                region: "–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥",
                price: 5000000,
                status: "active",
                deadline: "2024-11-30",
                description: "–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —Å–∏—Å—Ç–µ–º—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–æ–±–æ—Ä–æ—Ç–æ–º"
            },
            {
                id: 3,
                title: "–°—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–∞–±–æ—Ç—ã –ø–æ —Ä–µ–º–æ–Ω—Ç—É –∑–¥–∞–Ω–∏—è",
                category: "–†–∞–±–æ—Ç—ã",
                subcategory: "–°—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ",
                region: "–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫",
                price: 15000000,
                status: "completed",
                deadline: "2024-10-15",
                description: "–ö–∞–ø–∏—Ç–∞–ª—å–Ω—ã–π —Ä–µ–º–æ–Ω—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–æ–≥–æ –∑–¥–∞–Ω–∏—è"
            }
        ];

        // –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–∞–Ω–Ω—ã—Ö
        function checkData() {
            const resultDiv = document.getElementById('dataResult');
            try {
                if (typeof mockPurchases !== 'undefined' && mockPurchases.length > 0) {
                    resultDiv.innerHTML = `<div class="result success">‚úÖ –û—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã: ${mockPurchases.length} –∑–∞–∫—É–ø–æ–∫</div>`;
                    console.log('–û—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:', mockPurchases);
                } else {
                    resultDiv.innerHTML = `<div class="result success">‚úÖ –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ: ${fallbackPurchases.length} –∑–∞–∫—É–ø–æ–∫</div>`;
                    console.log('–†–µ–∑–µ—Ä–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:', fallbackPurchases);
                }
            } catch (e) {
                resultDiv.innerHTML = `<div class="result success">‚úÖ –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ: ${fallbackPurchases.length} –∑–∞–∫—É–ø–æ–∫</div>`;
                console.log('–†–µ–∑–µ—Ä–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:', fallbackPurchases);
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –ø–æ–∏—Å–∫–∞
        function performSearch() {
            const resultDiv = document.getElementById('searchResult');
            const resultsDiv = document.getElementById('searchResults');
            const searchText = document.getElementById('searchInput').value.trim();
            
            if (!searchText) {
                resultDiv.innerHTML = `<div class="result error">‚ùå –í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è –ø–æ–∏—Å–∫–∞</div>`;
                return;
            }
            
            try {
                let results = [];
                const purchases = typeof mockPurchases !== 'undefined' ? mockPurchases : fallbackPurchases;
                
                if (typeof searchPurchases === 'function') {
                    results = searchPurchases(searchText);
                } else {
                    // –ü—Ä–æ—Å—Ç–æ–π –ø–æ–∏—Å–∫ –µ—Å–ª–∏ –æ—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞
                    results = purchases.filter(purchase => 
                        purchase.title.toLowerCase().includes(searchText.toLowerCase()) ||
                        purchase.description.toLowerCase().includes(searchText.toLowerCase()) ||
                        purchase.category.toLowerCase().includes(searchText.toLowerCase()) ||
                        purchase.region.toLowerCase().includes(searchText.toLowerCase())
                    );
                }
                
                resultDiv.innerHTML = `<div class="result success">‚úÖ –ü–æ–∏—Å–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω: –Ω–∞–π–¥–µ–Ω–æ ${results.length} —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤</div>`;
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
                if (results.length > 0) {
                    resultsDiv.innerHTML = results.map(purchase => `
                        <div class="purchase-item">
                            <div class="purchase-title">${purchase.title}</div>
                            <div class="purchase-details">
                                <strong>–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</strong> ${purchase.category} ‚Ä¢ 
                                <strong>–†–µ–≥–∏–æ–Ω:</strong> ${purchase.region} ‚Ä¢ 
                                <strong>–¶–µ–Ω–∞:</strong> <span class="price">${formatPrice(purchase.price)}</span> ‚Ä¢ 
                                <span class="status ${purchase.status}">${purchase.status === 'active' ? '–ê–∫—Ç–∏–≤–Ω–∞' : '–ó–∞–≤–µ—Ä—à–µ–Ω–∞'}</span>
                            </div>
                        </div>
                    `).join('');
                } else {
                    resultsDiv.innerHTML = '<div class="result">–ü–æ –≤–∞—à–µ–º—É –∑–∞–ø—Ä–æ—Å—É –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</div>';
                }
                
                console.log('–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞:', results);
                
            } catch (e) {
                resultDiv.innerHTML = `<div class="result error">‚ùå –û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞: ${e.message}</div>`;
                console.error('–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞:', e);
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –ø–æ–∏—Å–∫–∞ —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏
        function performFilteredSearch() {
            const resultDiv = document.getElementById('filteredResult');
            const resultsDiv = document.getElementById('filteredResults');
            const category = document.getElementById('categoryFilter').value;
            const region = document.getElementById('regionFilter').value;
            
            try {
                let results = [];
                const purchases = typeof mockPurchases !== 'undefined' ? mockPurchases : fallbackPurchases;
                
                if (typeof searchPurchases === 'function') {
                    const filters = {};
                    if (category) filters.category = category;
                    if (region) filters.region = region;
                    results = searchPurchases('', filters);
                } else {
                    // –ü—Ä–æ—Å—Ç–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –µ—Å–ª–∏ –æ—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞
                    results = purchases.filter(purchase => {
                        if (category && purchase.category !== category) return false;
                        if (region && purchase.region !== region) return false;
                        return true;
                    });
                }
                
                resultDiv.innerHTML = `<div class="result success">‚úÖ –§–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–∏—Å–∫: –Ω–∞–π–¥–µ–Ω–æ ${results.length} —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤</div>`;
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
                if (results.length > 0) {
                    resultsDiv.innerHTML = results.map(purchase => `
                        <div class="purchase-item">
                            <div class="purchase-title">${purchase.title}</div>
                            <div class="purchase-details">
                                <strong>–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</strong> ${purchase.category} ‚Ä¢ 
                                <strong>–†–µ–≥–∏–æ–Ω:</strong> ${purchase.region} ‚Ä¢ 
                                <strong>–¶–µ–Ω–∞:</strong> <span class="price">${formatPrice(purchase.price)}</span> ‚Ä¢ 
                                <span class="status ${purchase.status}">${purchase.status === 'active' ? '–ê–∫—Ç–∏–≤–Ω–∞' : '–ó–∞–≤–µ—Ä—à–µ–Ω–∞'}</span>
                            </div>
                        </div>
                    `).join('');
                } else {
                    resultsDiv.innerHTML = '<div class="result">–ü–æ –≤—ã–±—Ä–∞–Ω–Ω—ã–º —Ñ–∏–ª—å—Ç—Ä–∞–º –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</div>';
                }
                
                console.log('–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞:', results);
                
            } catch (e) {
                resultDiv.innerHTML = `<div class="result error">‚ùå –û—à–∏–±–∫–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞: ${e.message}</div>`;
                console.error('–û—à–∏–±–∫–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞:', e);
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        function runComprehensiveTest() {
            const resultDiv = document.getElementById('comprehensiveResult');
            let results = [];
            
            try {
                // –¢–µ—Å—Ç 1: –î–∞–Ω–Ω—ã–µ
                const purchases = typeof mockPurchases !== 'undefined' ? mockPurchases : fallbackPurchases;
                results.push(`‚úÖ –î–∞–Ω–Ω—ã–µ –¥–æ—Å—Ç—É–ø–Ω—ã: ${purchases.length} –∑–∞–∫—É–ø–æ–∫`);
                
                // –¢–µ—Å—Ç 2: –§—É–Ω–∫—Ü–∏–∏
                if (typeof searchPurchases === 'function') {
                    results.push('‚úÖ –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –ø–æ–∏—Å–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–∞');
                } else {
                    results.push('‚ö†Ô∏è –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –ø–æ–∏—Å–∫–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ä–µ–∑–µ—Ä–≤–Ω–∞—è');
                }
                
                if (typeof performAdvancedSearch === 'function') {
                    results.push('‚úÖ –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –ø–æ–∏—Å–∫ –¥–æ—Å—Ç—É–ø–µ–Ω');
                } else {
                    results.push('‚ö†Ô∏è –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –ø–æ–∏—Å–∫ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
                }
                
                // –¢–µ—Å—Ç 3: –ü–æ–∏—Å–∫
                try {
                    const searchResults = purchases.filter(p => p.title.toLowerCase().includes('–∫–æ–º–ø—å—é—Ç–µ—Ä'));
                    results.push(`‚úÖ –ü–æ–∏—Å–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç: –Ω–∞–π–¥–µ–Ω–æ ${searchResults.length} —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ "–∫–æ–º–ø—å—é—Ç–µ—Ä"`);
                } catch (e) {
                    results.push(`‚ùå –ü–æ–∏—Å–∫ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç: ${e.message}`);
                }
                
                // –¢–µ—Å—Ç 4: –§–∏–ª—å—Ç—Ä—ã
                try {
                    const filteredResults = purchases.filter(p => p.category === '–£—Å–ª—É–≥–∏');
                    results.push(`‚úÖ –§–∏–ª—å—Ç—Ä—ã —Ä–∞–±–æ—Ç–∞—é—Ç: –Ω–∞–π–¥–µ–Ω–æ ${filteredResults.length} —É—Å–ª—É–≥`);
                } catch (e) {
                    results.push(`‚ùå –§–∏–ª—å—Ç—Ä—ã –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç: ${e.message}`);
                }
                
                resultDiv.innerHTML = results.map(r => `<div class="result">${r}</div>`).join('');
                
            } catch (e) {
                resultDiv.innerHTML = `<div class="result error">‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: ${e.message}</div>`;
                console.error('–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞:', e);
            }
        }

        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ü–µ–Ω—ã
        function formatPrice(price) {
            if (typeof formatPrice === 'function') {
                return formatPrice(price, 'RUB');
            }
            return new Intl.NumberFormat('ru-RU', {
                style: 'currency',
                currency: 'RUB',
                minimumFractionDigits: 0
            }).format(price);
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', () => {
            console.log('–°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞, –ø—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Ñ—É–Ω–∫—Ü–∏–π...');
            setTimeout(() => {
                checkData();
            }, 1000);
        });
    </script>
</body>
</html>
