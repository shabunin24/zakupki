<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ë—ã—Å—Ç—Ä—ã–π —Ç–µ—Å—Ç –Ø–Ω–¥–µ–∫—Å –ø–æ–∏—Å–∫–∞</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 8px; }
        .success { background: #d4edda; border-color: #c3e6cb; }
        .error { background: #f8d7da; border-color: #f5c6cb; }
        .search-box { margin: 20px 0; }
        input[type="text"] { padding: 10px; font-size: 16px; width: 300px; }
        button { padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        .results { margin-top: 20px; }
        .result-item { padding: 10px; margin: 5px 0; background: #f8f9fa; border-radius: 4px; }
    </style>
</head>
<body>
    <h1>üß™ –ë—ã—Å—Ç—Ä—ã–π —Ç–µ—Å—Ç –Ω–∞—Ç–∏–≤–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞ –≤ —Å—Ç–∏–ª–µ –Ø–Ω–¥–µ–∫—Å</h1>
    
    <div class="test-section success">
        <h3>‚úÖ –¢–µ—Å—Ç 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö</h3>
        <div id="dataTest">–ü—Ä–æ–≤–µ—Ä—è–µ–º...</div>
    </div>
    
    <div class="test-section">
        <h3>üîç –¢–µ—Å—Ç 2: –ü–æ–∏—Å–∫ –ø–æ —Å–ª–æ–≤—É "–∫—Ä–∞—Å–∫–∞"</h3>
        <div class="search-box">
            <input type="text" id="searchInput" placeholder="–í–≤–µ–¥–∏—Ç–µ '–∫—Ä–∞—Å–∫–∞' –¥–ª—è —Ç–µ—Å—Ç–∞">
            <button onclick="testSearch()">–ù–∞–π—Ç–∏</button>
        </div>
        <div id="searchResults" class="results"></div>
    </div>
    
    <div class="test-section">
        <h3>üìä –¢–µ—Å—Ç 3: –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–∏—Å–∫–∞</h3>
        <div id="searchStats"></div>
    </div>
    
    <div class="test-section">
        <h3>üéØ –¢–µ—Å—Ç 4: –ê–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ</h3>
        <div id="suggestionsTest"></div>
    </div>

    <script>
        // –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ —Å –∫—Ä–∞—Å–∫–æ–π
        const testPurchases = [
            {
                id: 1,
                title: "–ü–æ—Å—Ç–∞–≤–∫–∞ –∫–æ–º–ø—å—é—Ç–µ—Ä–Ω–æ–π —Ç–µ—Ö–Ω–∏–∫–∏",
                category: "–¢–æ–≤–∞—Ä—ã",
                region: "–ú–æ—Å–∫–≤–∞",
                price: 2500000,
                description: "–ö–æ–º–ø—å—é—Ç–µ—Ä—ã –∏ –Ω–æ—É—Ç–±—É–∫–∏ –¥–ª—è –æ—Ñ–∏—Å–∞"
            },
            {
                id: 2,
                title: "–ü–æ—Å—Ç–∞–≤–∫–∞ –ª–∞–∫–æ–∫—Ä–∞—Å–æ—á–Ω—ã—Ö –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤",
                category: "–¢–æ–≤–∞—Ä—ã", 
                region: "–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥",
                price: 1200000,
                description: "–ö—Ä–∞—Å–∫–∏, –ª–∞–∫–∏, –≥—Ä—É–Ω—Ç–æ–≤–∫–∏ –¥–ª—è —Ä–µ–º–æ–Ω—Ç–∞"
            },
            {
                id: 3,
                title: "–£—Å–ª—É–≥–∏ –ø–æ –ø–æ–∫—Ä–∞—Å–∫–µ –ø–æ–º–µ—â–µ–Ω–∏–π",
                category: "–£—Å–ª—É–≥–∏",
                region: "–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫", 
                price: 800000,
                description: "–ú–∞–ª—è—Ä–Ω—ã–µ —Ä–∞–±–æ—Ç—ã, –ø–æ–∫—Ä–∞—Å–∫–∞ —Å—Ç–µ–Ω –∏ –ø–æ—Ç–æ–ª–∫–æ–≤"
            }
        ];

        // –ü—Ä–æ—Å—Ç–æ–π –ø–æ–∏—Å–∫–æ–≤—ã–π –∏–Ω–¥–µ–∫—Å
        const searchIndex = new Map();
        
        function buildSearchIndex() {
            testPurchases.forEach(purchase => {
                const text = `${purchase.title} ${purchase.description} ${purchase.category} ${purchase.region}`.toLowerCase();
                const words = text.split(/\s+/);
                
                words.forEach(word => {
                    if (word.length > 2) {
                        if (!searchIndex.has(word)) {
                            searchIndex.set(word, []);
                        }
                        searchIndex.get(word).push(purchase.id);
                    }
                });
            });
            
            console.log('–ü–æ–∏—Å–∫–æ–≤—ã–π –∏–Ω–¥–µ–∫—Å –ø–æ—Å—Ç—Ä–æ–µ–Ω:', searchIndex.size, '—Å–ª–æ–≤');
        }

        // –§—É–Ω–∫—Ü–∏—è –ø–æ–∏—Å–∫–∞
        function search(query) {
            const queryLower = query.toLowerCase();
            const results = [];
            const foundIds = new Set();
            
            for (const [word, ids] of searchIndex) {
                if (word.includes(queryLower) || queryLower.includes(word)) {
                    ids.forEach(id => {
                        if (!foundIds.has(id)) {
                            const purchase = testPurchases.find(p => p.id === id);
                            if (purchase) {
                                const relevance = calculateRelevance(purchase, query);
                                results.push({ purchase, relevance });
                                foundIds.add(id);
                            }
                        }
                    });
                }
            }
            
            return results.sort((a, b) => b.relevance - a.relevance);
        }

        // –†–∞—Å—á–µ—Ç —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏
        function calculateRelevance(purchase, query) {
            const queryLower = query.toLowerCase();
            let relevance = 0;
            
            if (purchase.title.toLowerCase().includes(queryLower)) relevance += 100;
            if (purchase.description.toLowerCase().includes(queryLower)) relevance += 50;
            if (purchase.category.toLowerCase().includes(queryLower)) relevance += 30;
            if (purchase.region.toLowerCase().includes(queryLower)) relevance += 20;
            
            return relevance;
        }

        // –¢–µ—Å—Ç –¥–∞–Ω–Ω—ã—Ö
        function testData() {
            const dataTest = document.getElementById('dataTest');
            const hasKraska = testPurchases.some(p => 
                p.title.toLowerCase().includes('–∫—Ä–∞—Å–∫–∞') || 
                p.description.toLowerCase().includes('–∫—Ä–∞—Å–∫–∞')
            );
            
            if (hasKraska) {
                dataTest.innerHTML = `
                    ‚úÖ –î–∞–Ω–Ω—ã–µ —Å–æ–¥–µ—Ä–∂–∞—Ç –∑–∞–∫—É–ø–∫–∏ —Å –∫—Ä–∞—Å–∫–æ–π<br>
                    üìä –í—Å–µ–≥–æ –∑–∞–∫—É–ø–æ–∫: ${testPurchases.length}<br>
                    üîç –ü–æ–∏—Å–∫–æ–≤—ã–π –∏–Ω–¥–µ–∫—Å: ${searchIndex.size} —Å–ª–æ–≤
                `;
            } else {
                dataTest.innerHTML = '‚ùå –î–∞–Ω–Ω—ã–µ –Ω–µ —Å–æ–¥–µ—Ä–∂–∞—Ç –∑–∞–∫—É–ø–∫–∏ —Å –∫—Ä–∞—Å–∫–æ–π';
                dataTest.parentElement.className = 'test-section error';
            }
        }

        // –¢–µ—Å—Ç –ø–æ–∏—Å–∫–∞
        function testSearch() {
            const query = document.getElementById('searchInput').value.trim();
            if (!query) return;
            
            const results = search(query);
            const resultsDiv = document.getElementById('searchResults');
            
            if (results.length === 0) {
                resultsDiv.innerHTML = '<div class="result-item">‚ùå –†–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</div>';
            } else {
                let html = `<h4>–ù–∞–π–¥–µ–Ω–æ ${results.length} —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:</h4>`;
                results.forEach(result => {
                    html += `
                        <div class="result-item">
                            <strong>${result.purchase.title}</strong><br>
                            üìç ${result.purchase.category} | ${result.purchase.region}<br>
                            üí∞ ${result.purchase.price.toLocaleString()} ‚ÇΩ<br>
                            üìù ${result.purchase.description}<br>
                            ‚≠ê –†–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å: ${result.relevance}
                        </div>
                    `;
                });
                resultsDiv.innerHTML = html;
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            showSearchStats(results, query);
        }

        // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–∏—Å–∫–∞
        function showSearchStats(results, query) {
            const statsDiv = document.getElementById('searchStats');
            
            if (results.length === 0) {
                statsDiv.innerHTML = '‚ùå –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ - –Ω–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤';
                return;
            }
            
            const categories = new Set(results.map(r => r.purchase.category));
            const regions = new Set(results.map(r => r.purchase.region));
            const avgPrice = results.reduce((sum, r) => sum + r.purchase.price, 0) / results.length;
            
            statsDiv.innerHTML = `
                <h4>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–∏—Å–∫–∞ –ø–æ "${query}":</h4>
                <div>üî¢ –†–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤: ${results.length}</div>
                <div>üìÇ –ö–∞—Ç–µ–≥–æ—Ä–∏–π: ${categories.size}</div>
                <div>üåç –†–µ–≥–∏–æ–Ω–æ–≤: ${regions.size}</div>
                <div>üí∞ –°—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞: ${avgPrice.toLocaleString()} ‚ÇΩ</div>
            `;
        }

        // –¢–µ—Å—Ç –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è
        function testSuggestions() {
            const suggestionsDiv = document.getElementById('suggestionsTest');
            const query = '–∫—Ä–∞—Å–∫–∞';
            
            const suggestions = [];
            for (const [word, ids] of searchIndex) {
                if (word.startsWith(query.toLowerCase()) || word.includes(query.toLowerCase())) {
                    const purchase = testPurchases.find(p => p.id === ids[0]);
                    if (purchase) {
                        suggestions.push(purchase.title);
                    }
                }
            }
            
            if (suggestions.length > 0) {
                suggestionsDiv.innerHTML = `
                    <h4>üí° –ü–æ–¥—Å–∫–∞–∑–∫–∏ –¥–ª—è "${query}":</h4>
                    ${suggestions.slice(0, 5).map(s => `<div>‚Ä¢ ${s}</div>`).join('')}
                `;
            } else {
                suggestionsDiv.innerHTML = '‚ùå –ü–æ–¥—Å–∫–∞–∑–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã';
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            buildSearchIndex();
            testData();
            testSuggestions();
            
            // –ê–≤—Ç–æ–ø–æ–∏—Å–∫ –ø—Ä–∏ Enter
            document.getElementById('searchInput').addEventListener('keydown', function(e) {
                if (e.key === 'Enter') {
                    testSearch();
                }
            });
        });
    </script>
</body>
</html>
