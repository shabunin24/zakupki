<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ì–æ—Å–ó–∞–∫—É–ø–∫–∏ - Telegram Mini App</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: #f8fafc;
            color: #1e293b;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* Header */
        .header {
            background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
            color: white;
            padding: 30px 0;
            margin: -20px -20px 30px -20px;
            border-radius: 0 0 20px 20px;
        }
        
        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
            font-weight: 300;
        }
        
        /* Telegram Status */
        .telegram-status {
            background: white;
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
            text-align: center;
        }
        
        .status-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }
        
        .status-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 10px;
        }
        
        .status-description {
            color: #64748b;
            margin-bottom: 20px;
        }
        
        /* Search Section */
        .search-section {
            background: white;
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }
        
        .search-form {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }
        
        .search-input {
            flex: 1;
            min-width: 300px;
            padding: 16px 20px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: #f8fafc;
        }
        
        .search-input:focus {
            outline: none;
            border-color: #3b82f6;
            background: white;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .search-button {
            background: linear-gradient(135deg, #059669 0%, #10b981 100%);
            color: white;
            border: none;
            padding: 16px 32px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
        }
        
        .search-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(5, 150, 105, 0.3);
        }
        
        /* Quick Actions */
        .quick-actions {
            background: white;
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }
        
        .actions-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .actions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .action-card {
            background: #f8fafc;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            text-decoration: none;
            color: inherit;
        }
        
        .action-card:hover {
            border-color: #3b82f6;
            background: #eff6ff;
            transform: translateY(-2px);
        }
        
        .action-icon {
            font-size: 2rem;
            margin-bottom: 10px;
        }
        
        .action-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 8px;
        }
        
        .action-description {
            font-size: 0.9rem;
            color: #64748b;
        }
        
        /* Features */
        .features {
            background: white;
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        
        .features-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        
        .feature-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: #f8fafc;
            border-radius: 8px;
        }
        
        .feature-icon {
            font-size: 1.5rem;
            color: #3b82f6;
        }
        
        .feature-text {
            font-size: 0.9rem;
            color: #475569;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .header {
                margin: -15px -15px 20px -15px;
                border-radius: 0 0 15px 15px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .search-form {
                flex-direction: column;
            }
            
            .search-input {
                min-width: auto;
            }
            
            .actions-grid {
                grid-template-columns: 1fr;
            }
            
            .features-grid {
                grid-template-columns: 1fr;
            }
        }
        
        /* Telegram WebApp Styles */
        .telegram-webapp {
            background: var(--tg-theme-bg-color, #f8fafc);
            color: var(--tg-theme-text-color, #1e293b);
        }
        
        .telegram-webapp .header {
            background: var(--tg-theme-button-color, linear-gradient(135deg, #1e40af 0%, #3b82f6 100%));
        }
        
        .telegram-webapp .search-button {
            background: var(--tg-theme-button-color, linear-gradient(135deg, #059669 0%, #10b981 100%));
        }
        
        .telegram-webapp .action-card:hover {
            border-color: var(--tg-theme-button-color, #3b82f6);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="header-content">
                <h1>üèõÔ∏è –ì–æ—Å–ó–∞–∫—É–ø–∫–∏</h1>
                <p>–ü–æ–∏—Å–∫ –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∑–∞–∫—É–ø–æ–∫ –ø–æ –≤—Å–µ–π –†–æ—Å—Å–∏–∏</p>
            </div>
        </div>

        <!-- Telegram Status -->
        <div class="telegram-status" id="telegramStatus">
            <div class="status-icon">üì±</div>
            <h2 class="status-title">Telegram Mini App</h2>
            <p class="status-description">–ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Telegram...</p>
        </div>

        <!-- Search Section -->
        <div class="search-section">
            <form class="search-form" id="searchForm">
                <input 
                    type="text" 
                    class="search-input" 
                    id="searchInput"
                    placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∑–∞–∫—É–ø–∫–∏, —Ç–æ–≤–∞—Ä–∞ –∏–ª–∏ —É—Å–ª—É–≥–∏..."
                    autocomplete="off"
                >
                <button type="submit" class="search-button">
                    üîç –ù–∞–π—Ç–∏ –∑–∞–∫—É–ø–∫–∏
                </button>
            </form>
            
            <div class="search-examples">
                <p style="color: #64748b; font-size: 14px; margin: 0; text-align: center;">
                    üí° –ü—Ä–∏–º–µ—Ä—ã: "–±—É–º–∞–≥–∞ –ê4 –æ—Ñ–∏—Å–Ω–∞—è", "—Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ –¥–æ—Ä–æ–≥", "–º–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ"
                </p>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="quick-actions">
            <h3 class="actions-title">üöÄ –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h3>
            <div class="actions-grid">
                <a href="index.html" class="action-card">
                    <div class="action-icon">üîç</div>
                    <div class="action-title">–ü–æ–ª–Ω—ã–π –ø–æ–∏—Å–∫</div>
                    <div class="action-description">–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã</div>
                </a>
                
                <a href="favorites.html" class="action-card">
                    <div class="action-icon">‚≠ê</div>
                    <div class="action-title">–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</div>
                    <div class="action-description">–°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –∑–∞–∫—É–ø–∫–∏</div>
                </a>
                
                <a href="purchase-detail.html" class="action-card">
                    <div class="action-icon">üìã</div>
                    <div class="action-title">–î–µ—Ç–∞–ª–∏ –∑–∞–∫—É–ø–∫–∏</div>
                    <div class="action-description">–ü—Ä–∏–º–µ—Ä –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏</div>
                </a>
                
                <a href="#" class="action-card" onclick="showNotification('üîî –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –±—É–¥—É—Ç –¥–æ—Å—Ç—É–ø–Ω—ã –≤ –ø–æ–ª–Ω–æ–π –≤–µ—Ä—Å–∏–∏!')">
                    <div class="action-icon">üîî</div>
                    <div class="action-title">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</div>
                    <div class="action-description">–û –Ω–æ–≤—ã—Ö –∑–∞–∫—É–ø–∫–∞—Ö</div>
                </a>
            </div>
        </div>

        <!-- Features -->
        <div class="features">
            <h3 class="features-title">‚ú® –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</h3>
            <div class="features-grid">
                <div class="feature-item">
                    <div class="feature-icon">üîç</div>
                    <div class="feature-text">–ü–æ–∏—Å–∫ –ø–æ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–º—É —è–∑—ã–∫—É</div>
                </div>
                <div class="feature-item">
                    <div class="feature-icon">üìç</div>
                    <div class="feature-text">–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º</div>
                </div>
                <div class="feature-item">
                    <div class="feature-icon">üí∞</div>
                    <div class="feature-text">–§–∏–ª—å—Ç—Ä—ã –ø–æ —Ü–µ–Ω–µ</div>
                </div>
                <div class="feature-item">
                    <div class="feature-icon">üìÖ</div>
                    <div class="feature-text">–§–∏–ª—å—Ç—Ä—ã –ø–æ –¥–∞—Ç–∞–º</div>
                </div>
                <div class="feature-item">
                    <div class="feature-icon">‚≠ê</div>
                    <div class="feature-text">–°–∏—Å—Ç–µ–º–∞ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ</div>
                </div>
                <div class="feature-item">
                    <div class="feature-icon">üì±</div>
                    <div class="feature-text">–ú–æ–±–∏–ª—å–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        function initializeApp() {
            // Check if running in Telegram WebApp
            if (window.Telegram && window.Telegram.WebApp) {
                document.body.classList.add('telegram-webapp');
                const tg = window.Telegram.WebApp;
                tg.ready();
                tg.expand();
                
                // Update status
                updateTelegramStatus(tg);
                
                console.log('Telegram WebApp –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω:', tg);
            } else {
                // Not in Telegram
                updateTelegramStatus(null);
            }

            // Setup event listeners
            setupEventListeners();
        }

        function updateTelegramStatus(tg) {
            const statusElement = document.getElementById('telegramStatus');
            
            if (tg) {
                statusElement.innerHTML = `
                    <div class="status-icon">‚úÖ</div>
                    <h2 class="status-title">–ó–∞–ø—É—â–µ–Ω–æ –≤ Telegram!</h2>
                    <p class="status-description">–í–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ Telegram WebApp</p>
                `;
                
                // Show user info if available
                if (tg.initDataUnsafe?.user) {
                    const user = tg.initDataUnsafe.user;
                    statusElement.innerHTML += `
                        <div style="margin-top: 15px; padding: 15px; background: #f0f9ff; border-radius: 8px; border: 1px solid #0ea5e9;">
                            <p style="margin: 0; color: #0c4a6e; font-size: 14px;">
                                <strong>üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:</strong> ${user.firstName || ''} ${user.lastName || ''}
                                ${user.username ? `(@${user.username})` : ''}
                            </p>
                        </div>
                    `;
                }
            } else {
                statusElement.innerHTML = `
                    <div class="status-icon">üñ•Ô∏è</div>
                    <h2 class="status-title">–í–µ—Ä—Å–∏—è –¥–ª—è –±—Ä–∞—É–∑–µ—Ä–∞</h2>
                    <p class="status-description">–≠—Ç–æ –≤–µ—Ä—Å–∏—è –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</p>
                    <div style="margin-top: 15px; padding: 15px; background: #fef3c7; border-radius: 8px; border: 1px solid #f59e0b;">
                        <p style="margin: 0; color: #92400e; font-size: 14px;">
                            <strong>üì± –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤ Telegram:</strong><br>
                            –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –±–æ—Ç–∞ @oborotn_bot –∏ –Ω–∞–∂–º–∏—Ç–µ "üöÄ –û—Ç–∫—Ä—ã—Ç—å –ì–æ—Å–ó–∞–∫—É–ø–∫–∏"
                        </p>
                    </div>
                `;
            }
        }

        function setupEventListeners() {
            // Search form
            document.getElementById('searchForm').addEventListener('submit', function(e) {
                e.preventDefault();
                performSearch();
            });
        }

        function performSearch() {
            const searchQuery = document.getElementById('searchInput').value.trim();
            if (!searchQuery) return;

            // Show notification
            showNotification(`üîç –ü–æ–∏—Å–∫: "${searchQuery}" - –∏—â–µ–º –∑–∞–∫—É–ø–∫–∏...`);
            
            // Perform actual search
            searchPurchases(searchQuery);
        }
        
        // Mock data for demonstration
        const mockPurchases = [
            {
                id: 1,
                title: "–ü–æ—Å—Ç–∞–≤–∫–∞ –∫–∞–Ω—Ü–µ–ª—è—Ä—Å–∫–∏—Ö —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã—Ö —É—á—Ä–µ–∂–¥–µ–Ω–∏–π",
                status: "published",
                price: 2500000,
                region: "–ú–æ—Å–∫–≤–∞",
                customer: "–î–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –≥. –ú–æ—Å–∫–≤—ã",
                deadline: "2024-12-31",
                method: "electronic_auction",
                description: "–ü–æ—Å—Ç–∞–≤–∫–∞ –±—É–º–∞–≥–∏ –ê4, —Ä—É—á–µ–∫, –∫–∞—Ä–∞–Ω–¥–∞—à–µ–π –∏ –¥—Ä—É–≥–∏—Ö –∫–∞–Ω—Ü–µ–ª—è—Ä—Å–∫–∏—Ö –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç–µ–π"
            },
            {
                id: 2,
                title: "–°—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ –∞–≤—Ç–æ–º–æ–±–∏–ª—å–Ω–æ–π –¥–æ—Ä–æ–≥–∏ —Ä–µ–≥–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è",
                status: "bidding",
                price: 150000000,
                region: "–ö—Ä–∞—Å–Ω–æ–¥–∞—Ä—Å–∫–∏–π –∫—Ä–∞–π",
                customer: "–ú–∏–Ω–∏—Å—Ç–µ—Ä—Å—Ç–≤–æ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞ –ö—Ä–∞—Å–Ω–æ–¥–∞—Ä—Å–∫–æ–≥–æ –∫—Ä–∞—è",
                deadline: "2024-11-15",
                method: "tender",
                description: "–°—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ –¥–æ—Ä–æ–≥–∏ –ø—Ä–æ—Ç—è–∂–µ–Ω–Ω–æ—Å—Ç—å—é 15 –∫–º —Å –º–æ—Å—Ç–æ–≤—ã–º–∏ –ø–µ—Ä–µ—Ö–æ–¥–∞–º–∏"
            },
            {
                id: 3,
                title: "–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–≥–æ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –¥–ª—è —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–æ–æ–±–æ—Ä–æ—Ç–∞",
                status: "evaluation",
                price: 8500000,
                region: "–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥",
                customer: "–ö–æ–º–∏—Ç–µ—Ç –ø–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –∏ —Å–≤—è–∑–∏",
                deadline: "2024-10-20",
                method: "request_proposals",
                description: "–°–æ–∑–¥–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–æ–æ–±–æ—Ä–æ—Ç–∞ –¥–ª—è –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã—Ö –æ—Ä–≥–∞–Ω–æ–≤"
            },
            {
                id: 4,
                title: "–ü–æ—Å—Ç–∞–≤–∫–∞ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–≥–æ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è –¥–ª—è –≥–æ—Ä–æ–¥—Å–∫–æ–π –±–æ–ª—å–Ω–∏—Ü—ã",
                status: "awarded",
                price: 45000000,
                region: "–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫",
                customer: "–ì–æ—Ä–æ–¥—Å–∫–∞—è –∫–ª–∏–Ω–∏—á–µ—Å–∫–∞—è –±–æ–ª—å–Ω–∏—Ü–∞ ‚Ññ1",
                deadline: "2024-09-30",
                method: "electronic_auction",
                description: "–ü–æ—Å—Ç–∞–≤–∫–∞ —Ä–µ–Ω—Ç–≥–µ–Ω–æ–≤—Å–∫–æ–≥–æ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è, –£–ó–ò –∞–ø–ø–∞—Ä–∞—Ç–æ–≤ –∏ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ–≥–æ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è"
            },
            {
                id: 5,
                title: "–û–∫–∞–∑–∞–Ω–∏–µ —É—Å–ª—É–≥ –ø–æ —É–±–æ—Ä–∫–µ –∏ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏—é —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏",
                status: "published",
                price: 1200000,
                region: "–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥",
                customer: "–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏—è –õ–µ–Ω–∏–Ω—Å–∫–æ–≥–æ —Ä–∞–π–æ–Ω–∞",
                deadline: "2024-12-15",
                method: "request_quotes",
                description: "–£–±–æ—Ä–∫–∞ —É–ª–∏—Ü, –≤—ã–≤–æ–∑ –º—É—Å–æ—Ä–∞, —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –∑–µ–ª–µ–Ω—ã—Ö –Ω–∞—Å–∞–∂–¥–µ–Ω–∏–π"
            }
        ];
        
        function searchPurchases(query) {
            // Show loading state
            showLoadingState();
            
            console.log('Starting search for:', query);
            
            // Simple and reliable search
            setTimeout(() => {
                try {
                    // Generate simple results based on query
                    const results = generateSimpleResults(query);
                    console.log('Generated results:', results.length);
                    showSearchResults(results, query, false);
                } catch (error) {
                    console.error('Search failed:', error);
                    // Always fallback to mock data
                    const filtered = mockPurchases.filter(purchase => 
                        purchase.title.toLowerCase().includes(query.toLowerCase()) ||
                        purchase.description.toLowerCase().includes(query.toLowerCase()) ||
                        purchase.region.toLowerCase().includes(query.toLowerCase()) ||
                        purchase.customer.toLowerCase().includes(query.toLowerCase())
                    );
                    console.log('Fallback results:', filtered.length);
                    showSearchResults(filtered, query, false);
                }
            }, 1000);
        }
        
        function generateSimpleResults(query) {
            const results = [];
            const queryLower = query.toLowerCase();
            
            console.log('Generating results for query:', queryLower);
            
            // Simple keyword matching
            if (queryLower.includes('–±—É–º–∞–≥–∞') || queryLower.includes('–∫–∞–Ω—Ü') || queryLower.includes('–æ—Ñ–∏—Å')) {
                console.log('Office supplies category detected');
                for (let i = 1; i <= 15; i++) {
                    results.push({
                        id: `office_${i}`,
                        title: `–ü–æ—Å—Ç–∞–≤–∫–∞ –∫–∞–Ω—Ü–µ–ª—è—Ä—Å–∫–∏—Ö —Ç–æ–≤–∞—Ä–æ–≤ ${i}`,
                        status: '–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ',
                        price: Math.floor(Math.random() * 1000000) + 100000,
                        region: '–ú–æ—Å–∫–≤–∞',
                        customer: '–î–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è',
                        deadline: '2024-12-31',
                        method: '–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã–π –∞—É–∫—Ü–∏–æ–Ω',
                        description: '–ü–æ—Å—Ç–∞–≤–∫–∞ –±—É–º–∞–≥–∏, —Ä—É—á–µ–∫, –∫–∞—Ä–∞–Ω–¥–∞—à–µ–π'
                    });
                }
            } else if (queryLower.includes('—Å—Ç—Ä–æ–∏—Ç–µ–ª—å') || queryLower.includes('–¥–æ—Ä–æ–≥') || queryLower.includes('—Ä–µ–º–æ–Ω—Ç')) {
                console.log('Construction category detected');
                for (let i = 1; i <= 20; i++) {
                    results.push({
                        id: `construction_${i}`,
                        title: `–°—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–∞–±–æ—Ç—ã ${i}`,
                        status: '–ü–æ–¥–∞—á–∞ –∑–∞—è–≤–æ–∫',
                        price: Math.floor(Math.random() * 10000000) + 1000000,
                        region: '–ö—Ä–∞—Å–Ω–æ–¥–∞—Ä—Å–∫–∏–π –∫—Ä–∞–π',
                        customer: '–ú–∏–Ω–∏—Å—Ç–µ—Ä—Å—Ç–≤–æ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞',
                        deadline: '2024-11-15',
                        method: '–û—Ç–∫—Ä—ã—Ç—ã–π –∫–æ–Ω–∫—É—Ä—Å',
                        description: '–°—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ –∏ —Ä–µ–º–æ–Ω—Ç –¥–æ—Ä–æ–≥'
                    });
                }
            } else {
                console.log('Generic category detected');
                for (let i = 1; i <= 25; i++) {
                    results.push({
                        id: `generic_${i}`,
                        title: `–ó–∞–∫—É–ø–∫–∞ ${query} ${i}`,
                        status: '–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ',
                        price: Math.floor(Math.random() * 500000) + 50000,
                        region: '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥',
                        customer: '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏—è –≥–æ—Ä–æ–¥–∞',
                        deadline: '2024-10-20',
                        method: '–ó–∞–ø—Ä–æ—Å –∫–æ—Ç–∏—Ä–æ–≤–æ–∫',
                        description: `–ü–æ—Å—Ç–∞–≤–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤ –∏ —É—Å–ª—É–≥ –ø–æ –∑–∞–ø—Ä–æ—Å—É: ${query}`
                    });
                }
            }
            
            console.log('Generated results count:', results.length);
            return results;
        }
        
        async function searchRealZakupki(query) {
            try {
                // Skip API call for now since it doesn't exist
                console.log('Skipping API call, using simulation directly');
                return await simulateZakupkiSearch(query);
            } catch (error) {
                console.error('Search simulation failed:', error);
                // Return empty array as fallback
                return [];
            }
        }
        
        async function simulateZakupkiSearch(query) {
            // Simulate real zakupki.gov.ru search results
            // This generates realistic data based on the search query
            const baseResults = generateRealisticResults(query);
            
            // Simulate network delay
            await new Promise(resolve => setTimeout(resolve, 500 + Math.random() * 1000));
            
            return baseResults;
        }
        
        function generateRealisticResults(query) {
            const results = [];
            const queryLower = query.toLowerCase();
            
            // Generate results based on search query
            if (queryLower.includes('–±—É–º–∞–≥–∞') || queryLower.includes('–∫–∞–Ω—Ü') || queryLower.includes('–æ—Ñ–∏—Å')) {
                // Office supplies
                for (let i = 1; i <= 25; i++) {
                    results.push({
                        id: `paper_${i}`,
                        title: `–ü–æ—Å—Ç–∞–≤–∫–∞ –∫–∞–Ω—Ü–µ–ª—è—Ä—Å–∫–∏—Ö —Ç–æ–≤–∞—Ä–æ–≤ ${i % 2 === 0 ? '–¥–ª—è —à–∫–æ–ª' : '–¥–ª—è –æ—Ñ–∏—Å–æ–≤'} ${getRandomRegion()}`,
                        status: getRandomStatus(),
                        price: Math.floor(Math.random() * 5000000) + 500000,
                        region: getRandomRegion(),
                        customer: getRandomCustomer('education'),
                        deadline: getRandomDeadline(),
                        method: getRandomMethod(),
                        description: `–ü–æ—Å—Ç–∞–≤–∫–∞ –±—É–º–∞–≥–∏ –ê4, —Ä—É—á–µ–∫, –∫–∞—Ä–∞–Ω–¥–∞—à–µ–π, –ø–∞–ø–æ–∫ –∏ –¥—Ä—É–≥–∏—Ö –∫–∞–Ω—Ü–µ–ª—è—Ä—Å–∫–∏—Ö –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç–µ–π –¥–ª—è ${i % 2 === 0 ? '–æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —É—á—Ä–µ–∂–¥–µ–Ω–∏–π' : '–≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã—Ö –æ—Ä–≥–∞–Ω–æ–≤'}`
                    });
                }
            } else if (queryLower.includes('—Å—Ç—Ä–æ–∏—Ç–µ–ª—å') || queryLower.includes('–¥–æ—Ä–æ–≥') || queryLower.includes('—Ä–µ–º–æ–Ω—Ç')) {
                // Construction
                for (let i = 1; i <= 35; i++) {
                    results.push({
                        id: `construction_${i}`,
                        title: `${getRandomConstructionType()} ${getRandomRegion()}`,
                        status: getRandomStatus(),
                        price: Math.floor(Math.random() * 500000000) + 10000000,
                        region: getRandomRegion(),
                        customer: getRandomCustomer('construction'),
                        deadline: getRandomDeadline(),
                        method: getRandomMethod(),
                        description: `${getRandomConstructionDescription()} –≤ ${getRandomRegion()}`
                    });
                }
            } else if (queryLower.includes('–º–µ–¥–∏—Ü–∏–Ω') || queryLower.includes('–±–æ–ª—å–Ω–∏—Ü') || queryLower.includes('–æ–±–æ—Ä—É–¥–æ–≤–∞–Ω')) {
                // Medical
                for (let i = 1; i <= 30; i++) {
                    results.push({
                        id: `medical_${i}`,
                        title: `–ü–æ—Å—Ç–∞–≤–∫–∞ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–≥–æ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è –¥–ª—è ${getRandomMedicalFacility()}`,
                        status: getRandomStatus(),
                        price: Math.floor(Math.random() * 100000000) + 5000000,
                        region: getRandomRegion(),
                        customer: getRandomCustomer('medical'),
                        deadline: getRandomDeadline(),
                        method: getRandomMethod(),
                        description: `–ü–æ—Å—Ç–∞–≤–∫–∞ ${getRandomMedicalEquipment()} –¥–ª—è –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏—Ö —É—á—Ä–µ–∂–¥–µ–Ω–∏–π`
                    });
                }
            } else if (queryLower.includes('–ø—Ä–æ–≥—Ä–∞–º–º') || queryLower.includes('—Å–æ—Ñ—Ç') || queryLower.includes('it')) {
                // IT/Software
                for (let i = 1; i <= 20; i++) {
                    results.push({
                        id: `it_${i}`,
                        title: `–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ ${getRandomSoftwareType()} –¥–ª—è ${getRandomCustomer('it')}`,
                        status: getRandomStatus(),
                        price: Math.floor(Math.random() * 50000000) + 2000000,
                        region: getRandomRegion(),
                        customer: getRandomCustomer('it'),
                        deadline: getRandomDeadline(),
                        method: getRandomMethod(),
                        description: `–°–æ–∑–¥–∞–Ω–∏–µ –∏ –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ ${getRandomSoftwareType()} –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤`
                    });
                }
            } else {
                // Generic search - generate diverse results
                for (let i = 1; i <= 40; i++) {
                    results.push({
                        id: `generic_${i}`,
                        title: `${getRandomGenericTitle()} ${getRandomRegion()}`,
                        status: getRandomStatus(),
                        price: Math.floor(Math.random() * 10000000) + 100000,
                        region: getRandomRegion(),
                        customer: getRandomCustomer('generic'),
                        deadline: getRandomDeadline(),
                        method: getRandomMethod(),
                        description: `${getRandomGenericDescription()} –≤ ${getRandomRegion()}`
                    });
                }
            }
            
            // Shuffle results to make them look more realistic
            return results.sort(() => Math.random() - 0.5);
        }
        
        // Helper functions for generating realistic data
        function getRandomRegion() {
            const regions = [
                '–ú–æ—Å–∫–≤–∞', '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥', '–ö—Ä–∞—Å–Ω–æ–¥–∞—Ä—Å–∫–∏–π –∫—Ä–∞–π', '–ú–æ—Å–∫–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å',
                '–†–æ—Å—Ç–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', '–°–≤–µ—Ä–¥–ª–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', '–†–µ—Å–ø—É–±–ª–∏–∫–∞ –¢–∞—Ç–∞—Ä—Å—Ç–∞–Ω',
                '–ù–∏–∂–µ–≥–æ—Ä–æ–¥—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', '–ß–µ–ª—è–±–∏–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', '–°–∞–º–∞—Ä—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å',
                '–†–µ—Å–ø—É–±–ª–∏–∫–∞ –ë–∞—à–∫–æ—Ä—Ç–æ—Å—Ç–∞–Ω', '–ö—Ä–∞—Å–Ω–æ—è—Ä—Å–∫–∏–π –∫—Ä–∞–π', '–ü–µ—Ä–º—Å–∫–∏–π –∫—Ä–∞–π',
                '–í–æ–ª–≥–æ–≥—Ä–∞–¥—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', '–í–æ—Ä–æ–Ω–µ–∂—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', '–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å'
            ];
            return regions[Math.floor(Math.random() * regions.length)];
        }
        
        function getRandomStatus() {
            const statuses = ['published', 'bidding', 'evaluation', 'awarded', 'completed'];
            const weights = [0.3, 0.25, 0.2, 0.15, 0.1]; // More realistic distribution
            const random = Math.random();
            let cumulative = 0;
            for (let i = 0; i < statuses.length; i++) {
                cumulative += weights[i];
                if (random <= cumulative) return statuses[i];
            }
            return statuses[0];
        }
        
        function getRandomMethod() {
            const methods = ['electronic_auction', 'tender', 'request_quotes', 'request_proposals'];
            const weights = [0.4, 0.3, 0.2, 0.1]; // Electronic auctions are most common
            const random = Math.random();
            let cumulative = 0;
            for (let i = 0; i < methods.length; i++) {
                cumulative += weights[i];
                if (random <= cumulative) return methods[i];
            }
            return methods[0];
        }
        
        function getRandomCustomer(type) {
            const customers = {
                education: [
                    '–î–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è', '–ú–∏–Ω–∏—Å—Ç–µ—Ä—Å—Ç–≤–æ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è', '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è',
                    '–ì–∏–º–Ω–∞–∑–∏—è', '–õ–∏—Ü–µ–π', '–®–∫–æ–ª–∞', '–£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç', '–ö–æ–ª–ª–µ–¥–∂'
                ],
                construction: [
                    '–ú–∏–Ω–∏—Å—Ç–µ—Ä—Å—Ç–≤–æ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞', '–î–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞', '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ—Ä–æ–≥',
                    '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏—è —Ä–∞–π–æ–Ω–∞', '–ì–æ—Ä–æ–¥—Å–∫–∞—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏—è', '–û–±–ª–∞—Å—Ç–Ω–æ–µ –ø—Ä–∞–≤–∏—Ç–µ–ª—å—Å—Ç–≤–æ'
                ],
                medical: [
                    '–ú–∏–Ω–∏—Å—Ç–µ—Ä—Å—Ç–≤–æ –∑–¥—Ä–∞–≤–æ–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è', '–î–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç –∑–¥—Ä–∞–≤–æ–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è',
                    '–ì–æ—Ä–æ–¥—Å–∫–∞—è –±–æ–ª—å–Ω–∏—Ü–∞', '–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è —Ä–∞–π–æ–Ω–Ω–∞—è –±–æ–ª—å–Ω–∏—Ü–∞', '–ü–æ–ª–∏–∫–ª–∏–Ω–∏–∫–∞',
                    '–ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–π —Ü–µ–Ω—Ç—Ä', '–°–∞–Ω–∞—Ç–æ—Ä–∏–π'
                ],
                it: [
                    '–ö–æ–º–∏—Ç–µ—Ç –ø–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∑–∞—Ü–∏–∏', '–î–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç IT', '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–≤—è–∑–∏',
                    '–¶–µ–Ω—Ç—Ä –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π', '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏—è –≥–æ—Ä–æ–¥–∞'
                ],
                generic: [
                    '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏—è', '–ú–∏–Ω–∏—Å—Ç–µ—Ä—Å—Ç–≤–æ', '–î–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç', '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ',
                    '–ö–æ–º–∏—Ç–µ—Ç', '–§–µ–¥–µ—Ä–∞–ª—å–Ω–∞—è —Å–ª—É–∂–±–∞', '–ê–≥–µ–Ω—Ç—Å—Ç–≤–æ'
                ]
            };
            
            const typeCustomers = customers[type] || customers.generic;
            const customer = typeCustomers[Math.floor(Math.random() * typeCustomers.length)];
            const region = getRandomRegion();
            
            return `${customer} ${region}`;
        }
        
        function getRandomDeadline() {
            const now = new Date();
            const futureDate = new Date(now.getTime() + Math.random() * 90 * 24 * 60 * 60 * 1000); // 0-90 days
            return futureDate.toISOString().split('T')[0];
        }
        
        function getRandomConstructionType() {
            const types = [
                '–°—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ –∞–≤—Ç–æ–º–æ–±–∏–ª—å–Ω–æ–π –¥–æ—Ä–æ–≥–∏',
                '–†–µ–º–æ–Ω—Ç –º–æ—Å—Ç–æ–≤–æ–≥–æ –ø–µ—Ä–µ—Ö–æ–¥–∞',
                '–°—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ –∂–∏–ª–æ–≥–æ –∫–æ–º–ø–ª–µ–∫—Å–∞',
                '–†–µ–∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –∑–¥–∞–Ω–∏—è',
                '–°—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ —à–∫–æ–ª—ã',
                '–†–µ–º–æ–Ω—Ç –¥–æ—Ä–æ–∂–Ω–æ–≥–æ –ø–æ–∫—Ä—ã—Ç–∏—è',
                '–°—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ –±–æ–ª—å–Ω–∏—Ü—ã',
                '–†–µ–∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏—è —Å—Ç–∞–¥–∏–æ–Ω–∞'
            ];
            return types[Math.floor(Math.random() * types.length)];
        }
        
        function getRandomConstructionDescription() {
            const descriptions = [
                '–°—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–∞–±–æ—Ç—ã –ø–æ –≤–æ–∑–≤–µ–¥–µ–Ω–∏—é –æ–±—ä–µ–∫—Ç–∞',
                '–†–µ–º–æ–Ω—Ç–Ω–æ-—Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–∞–±–æ—Ç—ã',
                '–°—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ –∏–Ω–∂–µ–Ω–µ—Ä–Ω—ã—Ö —Å–µ—Ç–µ–π',
                '–ë–ª–∞–≥–æ—É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏',
                '–°—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ –ø–æ–¥—ä–µ–∑–¥–Ω—ã—Ö –ø—É—Ç–µ–π'
            ];
            return descriptions[Math.floor(Math.random() * descriptions.length)];
        }
        
        function getRandomMedicalFacility() {
            const facilities = [
                '–≥–æ—Ä–æ–¥—Å–∫–æ–π –±–æ–ª—å–Ω–∏—Ü—ã', '–ø–æ–ª–∏–∫–ª–∏–Ω–∏–∫–∏', '–º–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–≥–æ —Ü–µ–Ω—Ç—Ä–∞',
                '—Å–∞–Ω–∞—Ç–æ—Ä–∏—è', '–¥–∏—Å–ø–∞–Ω—Å–µ—Ä–∞', '—Ä–æ–¥–¥–æ–º–∞', '—Ç—Ä–∞–≤–º–ø—É–Ω–∫—Ç–∞'
            ];
            return facilities[Math.floor(Math.random() * facilities.length)];
        }
        
        function getRandomMedicalEquipment() {
            const equipment = [
                '—Ä–µ–Ω—Ç–≥–µ–Ω–æ–≤—Å–∫–æ–≥–æ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è', '–£–ó–ò –∞–ø–ø–∞—Ä–∞—Ç–æ–≤', '–ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ–≥–æ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è',
                '–∫–∞—Ä–¥–∏–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–≥–æ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è', '—Å—Ç–æ–º–∞—Ç–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–≥–æ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è',
                '—Ñ–∏–∑–∏–æ—Ç–µ—Ä–∞–ø–µ–≤—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è', '—Ä–µ–∞–Ω–∏–º–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è'
            ];
            return equipment[Math.floor(Math.random() * equipment.length)];
        }
        
        function getRandomSoftwareType() {
            const types = [
                '–ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–≥–æ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è', '–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã', '–≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è',
                '–º–æ–±–∏–ª—å–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è', '–±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö', '—Å–∏—Å—Ç–µ–º—ã —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–æ–æ–±–æ—Ä–æ—Ç–∞'
            ];
            return types[Math.floor(Math.random() * types.length)];
        }
        
        function getRandomGenericTitle() {
            const titles = [
                '–ü–æ—Å—Ç–∞–≤–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã—Ö –Ω—É–∂–¥',
                '–û–∫–∞–∑–∞–Ω–∏–µ —É—Å–ª—É–≥ –ø–æ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏—é —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏',
                '–ü–æ—Å—Ç–∞–≤–∫–∞ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –ø–∏—Ç–∞–Ω–∏—è',
                '–û–∫–∞–∑–∞–Ω–∏–µ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—ã—Ö —É—Å–ª—É–≥',
                '–ü–æ—Å—Ç–∞–≤–∫–∞ –º–µ–±–µ–ª–∏ –∏ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è',
                '–û–∫–∞–∑–∞–Ω–∏–µ —É—Å–ª—É–≥ —Å–≤—è–∑–∏',
                '–ü–æ—Å—Ç–∞–≤–∫–∞ —Å–ø–µ—Ü–æ–¥–µ–∂–¥—ã',
                '–û–∫–∞–∑–∞–Ω–∏–µ –æ—Ö—Ä–∞–Ω–Ω—ã—Ö —É—Å–ª—É–≥'
            ];
            return titles[Math.floor(Math.random() * titles.length)];
        }
        
        function getRandomGenericDescription() {
            const descriptions = [
                '–û–∫–∞–∑–∞–Ω–∏–µ —É—Å–ª—É–≥ –ø–æ –ø–æ—Å—Ç–∞–≤–∫–µ —Ç–æ–≤–∞—Ä–æ–≤',
                '–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ä–∞–±–æ—Ç –ø–æ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—é',
                '–ü–æ—Å—Ç–∞–≤–∫–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–≥–æ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è',
                '–û–∫–∞–∑–∞–Ω–∏–µ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–æ–Ω–Ω—ã—Ö —É—Å–ª—É–≥',
                '–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ä–µ–º–æ–Ω—Ç–Ω—ã—Ö —Ä–∞–±–æ—Ç'
            ];
            return descriptions[Math.floor(Math.random() * descriptions.length)];
        }
        
        function showLoadingState() {
            const searchSection = document.querySelector('.search-section');
            searchSection.innerHTML = `
                <div style="text-align: center; padding: 40px;">
                    <div style="font-size: 3rem; margin-bottom: 20px;">üîç</div>
                    <h3 style="color: #1e293b; margin-bottom: 20px;">–ò—â–µ–º –∑–∞–∫—É–ø–∫–∏...</h3>
                    <div style="
                        width: 40px;
                        height: 40px;
                        border: 4px solid #e2e8f0;
                        border-top: 4px solid #3b82f6;
                        border-radius: 50%;
                        animation: spin 1s linear infinite;
                        margin: 0 auto;
                    "></div>
                    <p style="color: #64748b; margin-top: 20px;">–ü–æ–∏—Å–∫ –ø–æ –∑–∞–ø—Ä–æ—Å—É: "${document.getElementById('searchInput').value}"</p>
                </div>
            `;
        }
        
        function showSearchResults(purchases, query, isRealData = false) {
            console.log('showSearchResults called with:', {purchases, query, isRealData});
            console.log('Purchases count:', purchases ? purchases.length : 'undefined');
            
            if (!purchases || purchases.length === 0) {
                console.log('No purchases to show, displaying empty state');
                const searchSection = document.querySelector('.search-section');
                searchSection.innerHTML = `
                    <div style="text-align: center; padding: 40px;">
                        <div style="font-size: 3rem; margin-bottom: 20px;">üîç</div>
                        <h3 style="color: #1e293b; margin-bottom: 10px;">–ó–∞–∫—É–ø–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h3>
                        <p style="color: #64748b;">–ü–æ –∑–∞–ø—Ä–æ—Å—É "${query}" –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</p>
                        <p style="color: #64748b; font-size: 14px; margin-top: 20px;">
                            –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –∑–∞–ø—Ä–æ—Å –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥—Ä—É–≥–∏–µ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞
                        </p>
                        <button onclick="showSearchForm()" style="
                            background: #3b82f6;
                            color: white;
                            border: none;
                            padding: 12px 24px;
                            border-radius: 8px;
                            cursor: pointer;
                            font-size: 14px;
                            margin-top: 20px;
                        ">
                            ‚Üê –ù–æ–≤—ã–π –ø–æ–∏—Å–∫
                        </button>
                    </div>
                `;
                return;
            }
            
            // Create results section
            const resultsHTML = createResultsHTML(purchases, query, isRealData);
            console.log('Results HTML created, length:', resultsHTML.length);
            
            // Replace search section with results
            const searchSection = document.querySelector('.search-section');
            if (searchSection) {
                searchSection.innerHTML = resultsHTML;
                console.log('Search section updated with results');
                
                // Add back button
                const backButton = document.createElement('div');
                backButton.innerHTML = `
                    <button onclick="showSearchForm()" style="
                        background: #3b82f6;
                        color: white;
                        border: none;
                        padding: 12px 24px;
                        border-radius: 8px;
                        cursor: pointer;
                        font-size: 14px;
                        margin-top: 20px;
                    ">
                        ‚Üê –ù–æ–≤—ã–π –ø–æ–∏—Å–∫
                    </button>
                `;
                searchSection.appendChild(backButton);
                console.log('Back button added');
            } else {
                console.error('Search section not found!');
            }
        }
        
        function createResultsHTML(purchases, query, isRealData = false) {
            if (purchases.length === 0) {
                return `
                    <div style="text-align: center; padding: 40px;">
                        <div style="font-size: 3rem; margin-bottom: 20px;">üîç</div>
                        <h3 style="color: #1e293b; margin-bottom: 10px;">–ó–∞–∫—É–ø–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h3>
                        <p style="color: #64748b;">–ü–æ –∑–∞–ø—Ä–æ—Å—É "${query}" –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</p>
                        <p style="color: #64748b; font-size: 14px; margin-top: 20px;">
                            –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –∑–∞–ø—Ä–æ—Å –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥—Ä—É–≥–∏–µ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞
                        </p>
                    </div>
                `;
            }
            
            const dataSource = isRealData ? 'üåê zakupki.gov.ru' : 'üì± –î–µ–º–æ-–¥–∞–Ω–Ω—ã–µ';
            
            let resultsHTML = `
                <h3 style="color: #1e293b; margin-bottom: 20px; text-align: center;">
                    üîç –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞: "${query}"
                </h3>
                <div style="
                    background: ${isRealData ? '#dbeafe' : '#fef3c7'};
                    color: ${isRealData ? '#1e40af' : '#d97706'};
                    padding: 8px 16px;
                    border-radius: 8px;
                    text-align: center;
                    margin-bottom: 20px;
                    font-size: 14px;
                    font-weight: 500;
                ">
                    ${dataSource} ‚Ä¢ –ù–∞–π–¥–µ–Ω–æ –∑–∞–∫—É–ø–æ–∫: ${purchases.length}
                </div>
                <div style="display: grid; gap: 20px;">
            `;
            
            purchases.forEach(purchase => {
                resultsHTML += createPurchaseCardHTML(purchase);
            });
            
            resultsHTML += '</div>';
            return resultsHTML;
        }
        
        function createPurchaseCardHTML(purchase) {
            const statusClass = `status-${purchase.status}`;
            const statusText = getStatusText(purchase.status);
            const methodText = getMethodText(purchase.method);
            const priceText = formatPrice(purchase.price);
            
            return `
                <div style="
                    background: white;
                    border: 1px solid #e2e8f0;
                    border-radius: 12px;
                    padding: 20px;
                    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
                ">
                    <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px;">
                        <h4 style="
                            font-size: 1.1rem;
                            font-weight: 600;
                            color: #1e293b;
                            line-height: 1.4;
                            margin: 0;
                            flex: 1;
                            margin-right: 15px;
                        ">${purchase.title}</h4>
                        <span style="
                            padding: 6px 12px;
                            border-radius: 20px;
                            font-size: 12px;
                            font-weight: 500;
                            white-space: nowrap;
                            ${getStatusStyle(purchase.status)}
                        ">${statusText}</span>
                    </div>
                    
                    <div style="
                        display: grid;
                        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                        gap: 15px;
                        margin-bottom: 15px;
                    ">
                        <div style="display: flex; align-items: center; gap: 8px; font-size: 14px; color: #64748b;">
                            <span>üìç</span>
                            <span>${purchase.region}</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 8px; font-size: 14px; color: #64748b;">
                            <span>üè¢</span>
                            <span>${purchase.customer}</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 8px; font-size: 14px; color: #64748b;">
                            <span>üìã</span>
                            <span>${methodText}</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 8px; font-size: 14px; color: #64748b;">
                            <span>‚è∞</span>
                            <span>–î–æ ${formatDate(purchase.deadline)}</span>
                        </div>
                    </div>
                    
                    <div style="
                        font-size: 1.2rem;
                        font-weight: 700;
                        color: #059669;
                        margin-bottom: 15px;
                    ">${priceText}</div>
                    
                    <div style="display: flex; gap: 10px; justify-content: flex-end;">
                        <button onclick="addToFavorites(${purchase.id})" style="
                            background: #f1f5f9;
                            color: #64748b;
                            border: none;
                            padding: 8px 16px;
                            border-radius: 8px;
                            cursor: pointer;
                            font-size: 14px;
                        ">‚≠ê –í –∏–∑–±—Ä–∞–Ω–Ω–æ–µ</button>
                        <button onclick="showPurchaseDetails(${purchase.id})" style="
                            background: #3b82f6;
                            color: white;
                            border: none;
                            padding: 8px 16px;
                            border-radius: 8px;
                            cursor: pointer;
                            font-size: 14px;
                        ">üìã –ü–æ–¥—Ä–æ–±–Ω–µ–µ</button>
                    </div>
                </div>
            `;
        }
        
        function getStatusText(status) {
            const statuses = {
                'published': '–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ',
                'bidding': '–ü–æ–¥–∞—á–∞ –∑–∞—è–≤–æ–∫',
                'evaluation': '–†–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–µ',
                'awarded': '–ü—Ä–∏—Å—É–∂–¥–µ–Ω–æ',
                'completed': '–ó–∞–≤–µ—Ä—à–µ–Ω–æ',
                'cancelled': '–û—Ç–º–µ–Ω–µ–Ω–æ'
            };
            return statuses[status] || status;
        }
        
        function getMethodText(method) {
            const methods = {
                'electronic_auction': '–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã–π –∞—É–∫—Ü–∏–æ–Ω',
                'tender': '–û—Ç–∫—Ä—ã—Ç—ã–π –∫–æ–Ω–∫—É—Ä—Å',
                'request_quotes': '–ó–∞–ø—Ä–æ—Å –∫–æ—Ç–∏—Ä–æ–≤–æ–∫',
                'request_proposals': '–ó–∞–ø—Ä–æ—Å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π'
            };
            return methods[method] || method;
        }
        
        function getStatusStyle(status) {
            const styles = {
                'published': 'background: #dbeafe; color: #1e40af;',
                'bidding': 'background: #fef3c7; color: #d97706;',
                'evaluation': 'background: #f3e8ff; color: #7c3aed;',
                'awarded': 'background: #d1fae5; color: #059669;',
                'completed': 'background: #d1fae5; color: #059669;',
                'cancelled': 'background: #fee2e2; color: #dc2626;'
            };
            return styles[status] || 'background: #f1f5f9; color: #64748b;';
        }
        
        function formatPrice(price) {
            if (price >= 1000000) {
                return `${(price / 1000000).toFixed(1)} –º–ª–Ω ‚ÇΩ`;
            } else if (price >= 1000) {
                return `${(price / 1000).toFixed(0)} —Ç—ã—Å ‚ÇΩ`;
            }
            return `${price} ‚ÇΩ`;
        }
        
        function formatDate(dateString) {
            return new Date(dateString).toLocaleDateString('ru-RU');
        }
        
        function showSearchForm() {
            // Restore original search form
            const searchSection = document.querySelector('.search-section');
            searchSection.innerHTML = `
                <form class="search-form" id="searchForm">
                    <input 
                        type="text" 
                        class="search-input" 
                        id="searchInput"
                        placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∑–∞–∫—É–ø–∫–∏, —Ç–æ–≤–∞—Ä–∞ –∏–ª–∏ —É—Å–ª—É–≥–∏..."
                        autocomplete="off"
                    >
                    <button type="submit" class="search-button">
                        üîç –ù–∞–π—Ç–∏ –∑–∞–∫—É–ø–∫–∏
                    </button>
                </form>
                
                <div class="search-examples">
                    <p style="color: #64748b; font-size: 14px; margin: 0; text-align: center; margin-bottom: 15px;">
                        üí° –ü—Ä–∏–º–µ—Ä—ã: "–±—É–º–∞–≥–∞ –ê4 –æ—Ñ–∏—Å–Ω–∞—è", "—Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ –¥–æ—Ä–æ–≥", "–º–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ"
                    </p>
                    <div style="text-align: center;">
                        <button onclick="debugSearch()" style="
                            background: #10b981;
                            color: white;
                            border: none;
                            padding: 8px 16px;
                            border-radius: 8px;
                            cursor: pointer;
                            font-size: 14px;
                            margin: 0 5px;
                        ">üß™ –¢–µ—Å—Ç –ø–æ–∏—Å–∫–∞</button>
                        <button onclick="console.log('Debug info:', {form: document.getElementById('searchForm'), input: document.getElementById('searchInput'), button: document.querySelector('.search-button')})" style="
                            background: #6b7280;
                            color: white;
                            border: none;
                            padding: 8px 16px;
                            border-radius: 8px;
                            cursor: pointer;
                            font-size: 14px;
                            margin: 0 5px;
                        ">üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —ç–ª–µ–º–µ–Ω—Ç—ã</button>
                    </div>
                </div>
            `;
            
            // Reattach event listener
            document.getElementById('searchForm').addEventListener('submit', function(e) {
                e.preventDefault();
                performSearch();
            });
        }
        
        function addToFavorites(purchaseId) {
            showNotification(`‚≠ê –ó–∞–∫—É–ø–∫–∞ ${purchaseId} –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ!`);
        }
        
        function showPurchaseDetails(purchaseId) {
            showNotification(`üìã –û—Ç–∫—Ä—ã–≤–∞–µ–º –¥–µ—Ç–∞–ª–∏ –∑–∞–∫—É–ø–∫–∏ ${purchaseId}...`);
            // Redirect to detail page
            setTimeout(() => {
                window.location.href = `purchase-detail.html?id=${purchaseId}`;
            }, 1000);
        }

        function showNotification(message) {
            try {
                // Always use browser notification for now to avoid WebApp errors
                console.log('Showing notification:', message);
                showBrowserNotification(message);
            } catch (error) {
                console.log('Notification failed:', error);
                // Last resort: console log
                console.log('NOTIFICATION:', message);
            }
        }
        
        function showBrowserNotification(message) {
            // Create a custom notification element
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #3b82f6;
                color: white;
                padding: 15px 20px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                z-index: 10000;
                max-width: 300px;
                word-wrap: break-word;
                animation: slideIn 0.3s ease-out;
            `;
            notification.textContent = message;
            
            // Add animation CSS
            if (!document.getElementById('notification-styles')) {
                const style = document.createElement('style');
                style.id = 'notification-styles';
                style.textContent = `
                    @keyframes slideIn {
                        from { transform: translateX(100%); opacity: 0; }
                        to { transform: translateX(0); opacity: 1; }
                    }
                    @keyframes slideOut {
                        from { transform: translateX(0); opacity: 1; }
                        to { transform: translateX(100%); opacity: 0; }
                    }
                `;
                document.head.appendChild(style);
            }
            
            document.body.appendChild(notification);
            
            // Auto-remove after 3 seconds
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease-out';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }
        
        // Initialize search form when page loads
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Page loaded, initializing search form...');
            
            // Check Telegram WebApp version and capabilities
            if (window.Telegram && window.Telegram.WebApp) {
                const tg = window.Telegram.WebApp;
                console.log('Telegram WebApp detected:', {
                    version: tg.version,
                    platform: tg.platform,
                    colorScheme: tg.colorScheme,
                    themeParams: tg.themeParams,
                    initData: tg.initData ? 'Available' : 'Not available',
                    initDataUnsafe: tg.initDataUnsafe ? 'Available' : 'Not available'
                });
                
                // Check available methods
                const availableMethods = [];
                if (tg.showPopup) availableMethods.push('showPopup');
                if (tg.showAlert) availableMethods.push('showAlert');
                if (tg.MainButton) availableMethods.push('MainButton');
                if (tg.BackButton) availableMethods.push('BackButton');
                
                console.log('Available Telegram methods:', availableMethods);
            } else {
                console.log('Telegram WebApp not detected, running in browser mode');
            }
            
            // Find the search form and attach event listener
            const searchForm = document.getElementById('searchForm');
            if (searchForm) {
                console.log('Search form found, attaching event listener...');
                searchForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    console.log('Search form submitted, calling performSearch...');
                    performSearch();
                });
            } else {
                console.error('Search form not found!');
            }
            
            // Also attach click event to search button for extra reliability
            const searchButton = document.querySelector('.search-button');
            if (searchButton) {
                console.log('Search button found, attaching click listener...');
                searchButton.addEventListener('click', function(e) {
                    e.preventDefault();
                    console.log('Search button clicked, calling performSearch...');
                    performSearch();
                });
            }
            
            console.log('Search form initialization complete!');
        });
        
        // Debug function to test search manually
        function debugSearch() {
            console.log('Debug search called');
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                console.log('Search input value:', searchInput.value);
                performSearch();
            } else {
                console.error('Search input not found!');
            }
        }
    </script>
</body>
</html>
