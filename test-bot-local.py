#!/usr/bin/env python3
"""
–õ–æ–∫–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç –±–æ—Ç–∞ –ì–æ—Å–ó–∞–∫—É–ø–∫–∏ –±–µ–∑ webhook
–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç, –∫–∞–∫ –±—É–¥—É—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –±–æ—Ç–∞
"""

import requests
import json

# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –±–æ—Ç–∞
BOT_TOKEN = "8203311811:AAEbVoeZ0inIO7CUFuGUbwNRdoL2xfpxfPw"
API_BASE = f"https://api.telegram.org/bot{BOT_TOKEN}"

def create_mini_app_keyboard():
    """–°–æ–∑–¥–∞–µ—Ç –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É —Å –∫–Ω–æ–ø–∫–æ–π Mini App"""
    return {
        "inline_keyboard": [
            [
                {
                    "text": "üöÄ –û—Ç–∫—Ä—ã—Ç—å –ì–æ—Å–ó–∞–∫—É–ø–∫–∏",
                    "web_app": {
                        "url": "http://localhost:3000"  # –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à URL
                    }
                }
            ],
            [
                {
                    "text": "üîç –ü–æ–∏—Å–∫ –∑–∞–∫—É–ø–æ–∫",
                    "callback_data": "search"
                },
                {
                    "text": "‚≠ê –ò–∑–±—Ä–∞–Ω–Ω–æ–µ",
                    "callback_data": "favorites"
                }
            ],
            [
                {
                    "text": "‚ÑπÔ∏è –ü–æ–º–æ—â—å",
                    "callback_data": "help"
                }
            ]
        ]
    }

def send_test_message(chat_id, text, reply_markup=None):
    """–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ"""
    url = f"{API_BASE}/sendMessage"
    data = {
        "chat_id": chat_id,
        "text": text,
        "parse_mode": "HTML"
    }
    
    if reply_markup:
        data["reply_markup"] = reply_markup
    
    try:
        response = requests.post(url, json=data)
        result = response.json()
        
        if result.get("ok"):
            print(f"‚úÖ –°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ —á–∞—Ç {chat_id}")
            return True
        else:
            print(f"‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏: {result}")
            return False
            
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞: {e}")
        return False

def test_start_command(chat_id):
    """–¢–µ—Å—Ç–∏—Ä—É–µ—Ç –∫–æ–º–∞–Ω–¥—É /start"""
    welcome_text = f"""
üéâ <b>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –ì–æ—Å–ó–∞–∫—É–ø–∫–∏!</b>

üëã –ü—Ä–∏–≤–µ—Ç, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å!

üîç <b>–ß—Ç–æ —É–º–µ–µ—Ç –±–æ—Ç:</b>
‚Ä¢ –ü–æ–∏—Å–∫ –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∑–∞–∫—É–ø–æ–∫
‚Ä¢ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
‚Ä¢ –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö –∑–∞–∫—É–ø–æ–∫
‚Ä¢ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–æ–≤—ã—Ö –∑–∞–∫—É–ø–∫–∞—Ö
‚Ä¢ –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–∫—É–ø–∫–∞—Ö

üöÄ <b>–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:</b>
    """
    
    keyboard = create_mini_app_keyboard()
    return send_test_message(chat_id, welcome_text, keyboard)

def test_search_response(chat_id):
    """–¢–µ—Å—Ç–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç –Ω–∞ –ø–æ–∏—Å–∫"""
    text = "üîç <b>–ü–æ–∏—Å–∫ –∑–∞–∫—É–ø–æ–∫</b>\n\n–û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –ø–æ–∏—Å–∫–∞ –∑–∞–∫—É–ø–æ–∫ —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–º–∏ —Ñ–∏–ª—å—Ç—Ä–∞–º–∏."
    keyboard = create_mini_app_keyboard()
    return send_test_message(chat_id, text, keyboard)

def test_favorites_response(chat_id):
    """–¢–µ—Å—Ç–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç –Ω–∞ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ"""
    text = "‚≠ê <b>–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</b>\n\n–û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö –∑–∞–∫—É–ø–æ–∫."
    keyboard = create_mini_app_keyboard()
    return send_test_message(chat_id, text, keyboard)

def test_help_response(chat_id):
    """–¢–µ—Å—Ç–∏—Ä—É–µ—Ç —Å–ø—Ä–∞–≤–∫—É"""
    help_text = """
‚ÑπÔ∏è <b>–°–ø—Ä–∞–≤–∫–∞ –ø–æ –±–æ—Ç—É –ì–æ—Å–ó–∞–∫—É–ø–∫–∏</b>

üîç <b>–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:</b>
‚Ä¢ <b>–ü–æ–∏—Å–∫ –∑–∞–∫—É–ø–æ–∫</b> - –Ω–∞–π–¥–∏—Ç–µ –∏–Ω—Ç–µ—Ä–µ—Å—É—é—â–∏–µ –≤–∞—Å –∑–∞–∫—É–ø–∫–∏
‚Ä¢ <b>–§–∏–ª—å—Ç—Ä—ã</b> - –ø–æ —Ä–µ–≥–∏–æ–Ω—É, —Ü–µ–Ω–µ, —Å—Ç–∞—Ç—É—Å—É, –º–µ—Ç–æ–¥—É –∑–∞–∫—É–ø–∫–∏
‚Ä¢ <b>–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</b> - —Å–æ—Ö—Ä–∞–Ω—è–π—Ç–µ –≤–∞–∂–Ω—ã–µ –∑–∞–∫—É–ø–∫–∏
‚Ä¢ <b>–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</b> - –ø–æ–ª—É—á–∞–π—Ç–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–æ–≤—ã—Ö –∑–∞–∫—É–ø–∫–∞—Ö

üì± <b>–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:</b>
1. –ù–∞–∂–º–∏—Ç–µ "üöÄ –û—Ç–∫—Ä—ã—Ç—å –ì–æ—Å–ó–∞–∫—É–ø–∫–∏"
2. –í –æ—Ç–∫—Ä—ã–≤—à–µ–º—Å—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä—ã
3. –î–æ–±–∞–≤–ª—è–π—Ç–µ –∑–∞–∫—É–ø–∫–∏ –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ
4. –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–π—Ç–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

üåê <b>–ò—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö:</b>
‚Ä¢ –ï–ò–° (zakupki.gov.ru)
‚Ä¢ –†–µ–≥–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø–æ—Ä—Ç–∞–ª—ã –∑–∞–∫—É–ø–æ–∫
‚Ä¢ –î—Ä—É–≥–∏–µ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏

üìû <b>–ü–æ–¥–¥–µ—Ä–∂–∫–∞:</b>
–ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –≤–æ–ø—Ä–æ—Å—ã, –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫—É.
    """
    keyboard = create_mini_app_keyboard()
    return send_test_message(chat_id, help_text, keyboard)

def main():
    print("üß™ –õ–æ–∫–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç –±–æ—Ç–∞ –ì–æ—Å–ó–∞–∫—É–ø–∫–∏")
    print("=" * 40)
    
    # –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º ID —á–∞—Ç–∞ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
    print("üì± –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –±–æ—Ç–∞ –Ω—É–∂–Ω–æ:")
    print("1. –û—Ç–∫—Ä–æ–π—Ç–µ @oborotn_bot –≤ Telegram")
    print("2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –ª—é–±–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ")
    print("3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ ID —á–∞—Ç–∞ –∏–∑ URL –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ @userinfobot")
    
    chat_id = input("\n–í–≤–µ–¥–∏—Ç–µ ID —á–∞—Ç–∞ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: ").strip()
    
    if not chat_id:
        print("‚ùå ID —á–∞—Ç–∞ –Ω–µ —É–∫–∞–∑–∞–Ω")
        return
    
    try:
        chat_id = int(chat_id)
    except ValueError:
        print("‚ùå ID —á–∞—Ç–∞ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —á–∏—Å–ª–æ–º")
        return
    
    print(f"\nüéØ –¢–µ—Å—Ç–∏—Ä—É—é –±–æ—Ç–∞ –≤ —á–∞—Ç–µ {chat_id}")
    print("=" * 40)
    
    # –¢–µ—Å—Ç–∏—Ä—É–µ–º –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏
    print("\n1Ô∏è‚É£ –¢–µ—Å—Ç–∏—Ä—É—é –∫–æ–º–∞–Ω–¥—É /start...")
    test_start_command(chat_id)
    
    print("\n2Ô∏è‚É£ –¢–µ—Å—Ç–∏—Ä—É—é –æ—Ç–≤–µ—Ç –Ω–∞ –ø–æ–∏—Å–∫...")
    test_search_response(chat_id)
    
    print("\n3Ô∏è‚É£ –¢–µ—Å—Ç–∏—Ä—É—é –æ—Ç–≤–µ—Ç –Ω–∞ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ...")
    test_favorites_response(chat_id)
    
    print("\n4Ô∏è‚É£ –¢–µ—Å—Ç–∏—Ä—É—é —Å–ø—Ä–∞–≤–∫—É...")
    test_help_response(chat_id)
    
    print("\n‚úÖ –¢–µ—Å—Ç –∑–∞–≤–µ—Ä—à–µ–Ω!")
    print("\nüì± –¢–µ–ø–µ—Ä—å –≤ Telegram:")
    print("‚Ä¢ –û—Ç–∫—Ä–æ–π—Ç–µ —á–∞—Ç —Å –±–æ—Ç–æ–º")
    print("‚Ä¢ –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É 'üöÄ –û—Ç–∫—Ä—ã—Ç—å –ì–æ—Å–ó–∞–∫—É–ø–∫–∏'")
    print("‚Ä¢ –î–æ–ª–∂–Ω–æ –æ—Ç–∫—Ä—ã—Ç—å—Å—è –≤–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ")

if __name__ == "__main__":
    main()
