# Правила парсинга денежных сумм

## Единицы измерения

### Основные единицы
- **руб** / **₽** → множитель 1
- **тыс** / **тысяч** → множитель 1,000
- **млн** / **миллион** / **миллионов** → множитель 1,000,000
- **млрд** / **миллиард** / **миллиардов** → множитель 1,000,000,000

### Альтернативные обозначения
- **тыс. руб** / **тыс рублей** → множитель 1,000
- **млн. руб** / **млн рублей** → множитель 1,000,000
- **млрд. руб** / **млрд рублей** → множитель 1,000,000,000

## Паттерны парсинга

### Простые суммы
- "5 млн" → `price = 5,000,000`
- "200 тыс" → `price = 200,000`
- "1.5 млрд" → `price = 1,500,000,000`

### Диапазоны цен
- "от 200 тыс до 1.5 млн" → `price_min = 200,000`, `price_max = 1,500,000`
- "с 5 млн по 20 млн" → `price_min = 5,000,000`, `price_max = 20,000,000`

### Ограничения
- "до 5 млн" → `price_max = 5,000,000`
- "от 1 млн" → `price_min = 1,000,000`
- "не более 10 млн" → `price_max = 10,000,000`
- "минимум 500 тыс" → `price_min = 500,000`

## Алгоритм извлечения

### Шаг 1: Поиск единиц измерения
1. Ищем ключевые слова: "млн", "тыс", "млрд", "руб", "₽"
2. Определяем множитель для каждой единицы

### Шаг 2: Поиск числовых значений
1. Ищем числа в формате: `\d+(?:\.\d+)?`
2. Поддерживаем десятичные дроби: 1.5, 2.75

### Шаг 3: Определение типа ограничения
1. **"до X"** → `price_max = X * multiplier`
2. **"от X"** → `price_min = X * multiplier`
3. **"X"** (без "до"/"от") → `price_max = X * multiplier` (по умолчанию)
4. **"от X до Y"** → `price_min = X * multiplier`, `price_max = Y * multiplier`

### Шаг 4: Нормализация
1. Приводим все суммы к базовой валюте (рубли)
2. Убираем дубликаты и пересечения
3. Устанавливаем разумные ограничения

## Примеры парсинга

```
"до 5 млн рублей" → price_max = 5,000,000
"от 200 тыс до 1.5 млн" → price_min = 200,000, price_max = 1,500,000
"не более 10 млн" → price_max = 10,000,000
"минимум 500 тыс" → price_min = 500,000
"1.25 млрд" → price = 1,250,000,000
"от 1 млн по 20 млн" → price_min = 1,000,000, price_max = 20,000,000
```

## Особые случаи

### Без указания валюты
- Если валюта не указана → по умолчанию рубли
- Если указана другая валюта → конвертация в рубли (если возможно)

### Неточные значения
- "около 5 млн" → `price_min = 4,500,000`, `price_max = 5,500,000`
- "примерно 1 млн" → `price_min = 900,000`, `price_max = 1,100,000`

### Диапазоны с шагом
- "от 1 до 5 млн с шагом 500 тыс" → `price_min = 1,000,000`, `price_max = 5,000,000`, `step = 500,000`
