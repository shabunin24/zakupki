<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –±–æ—Ç–∞ –ì–æ—Å–ó–∞–∫—É–ø–∫–∏</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .debug-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 8px; }
        .success { background: #d4edda; border-color: #c3e6cb; }
        .error { background: #f8d7da; border-color: #f5c6cb; }
        .warning { background: #fff3cd; border-color: #ffeaa7; }
        .debug-info { font-family: monospace; background: #f8f9fa; padding: 10px; border-radius: 4px; margin: 10px 0; }
        .test-button { padding: 10px 20px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        .test-button:hover { background: #0056b3; }
    </style>
</head>
<body>
    <h1>üîß –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –±–æ—Ç–∞ –ì–æ—Å–ó–∞–∫—É–ø–∫–∏</h1>
    
    <div class="debug-section">
        <h3>üìã –¢–µ—Å—Ç 1: –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤</h3>
        <div id="fileTest">
            <p>–ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–≥—Ä—É–∑–∫—É —Ñ–∞–π–ª–æ–≤...</p>
        </div>
    </div>
    
    <div class="debug-section">
        <h3>‚öôÔ∏è –¢–µ—Å—Ç 2: –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏</h3>
        <div id="functionTest">
            <p>–ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ—É–Ω–∫—Ü–∏–∏...</p>
        </div>
    </div>
    
    <div class="debug-section">
        <h3>üîç –¢–µ—Å—Ç 3: –ü–æ–∏—Å–∫</h3>
        <div id="searchTest">
            <p>–ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–∏—Å–∫...</p>
        </div>
    </div>
    
    <div class="debug-section">
        <h3>üè† –¢–µ—Å—Ç 4: –í–∫–ª–∞–¥–∫–∏</h3>
        <div id="tabTest">
            <p>–ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–∫–ª–∞–¥–∫–∏...</p>
        </div>
        <div>
            <button class="test-button" onclick="testTab('home')">üè† –ì–ª–∞–≤–Ω–∞—è</button>
            <button class="test-button" onclick="testTab('search')">üîç –ü–æ–∏—Å–∫</button>
            <button class="test-button" onclick="testTab('favorites')">‚≠ê –ò–∑–±—Ä–∞–Ω–Ω–æ–µ</button>
            <button class="test-button" onclick="testTab('profile')">üë§ –ü—Ä–æ—Ñ–∏–ª—å</button>
        </div>
    </div>
    
    <div class="debug-section">
        <h3>üì± –¢–µ—Å—Ç 5: Telegram Web App</h3>
        <div id="telegramTest">
            <p>–ü—Ä–æ–≤–µ—Ä—è–µ–º Telegram...</p>
        </div>
    </div>
    
    <div class="debug-section">
        <h3>üö® –û—à–∏–±–∫–∏ –∫–æ–Ω—Å–æ–ª–∏</h3>
        <div id="consoleErrors">
            <p>–û—à–∏–±–∫–∏ –±—É–¥—É—Ç –ø–æ–∫–∞–∑–∞–Ω—ã –∑–¥–µ—Å—å...</p>
        </div>
        <button class="test-button" onclick="checkConsoleErrors()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—à–∏–±–∫–∏</button>
    </div>

    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="config.js"></script>
    <script src="script.js"></script>
    
    <script>
        let consoleErrors = [];
        
        // –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º –æ—à–∏–±–∫–∏ –∫–æ–Ω—Å–æ–ª–∏
        const originalError = console.error;
        const originalWarn = console.warn;
        
        console.error = function(...args) {
            consoleErrors.push({ type: 'error', args, timestamp: new Date().toISOString() });
            originalError.apply(console, args);
        };
        
        console.warn = function(...args) {
            consoleErrors.push({ type: 'warn', args, timestamp: new Date().toISOString() });
            originalWarn.apply(console, args);
        };
        
        // –¢–µ—Å—Ç –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤
        function testFileLoading() {
            const fileTest = document.getElementById('fileTest');
            let html = '<h4>–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–π–ª–æ–≤:</h4>';
            
            const files = [
                { name: 'config.js', url: 'config.js' },
                { name: 'script.js', url: 'script.js' },
                { name: 'styles.css', url: 'styles.css' }
            ];
            
            let successCount = 0;
            files.forEach(file => {
                fetch(file.url)
                    .then(response => {
                        if (response.ok) {
                            html += `<div class="debug-info success">‚úÖ ${file.name} - –∑–∞–≥—Ä—É–∂–µ–Ω (${response.status})</div>`;
                            successCount++;
                        } else {
                            html += `<div class="debug-info error">‚ùå ${file.name} - –æ—à–∏–±–∫–∞ ${response.status}</div>`;
                        }
                        
                        if (successCount === files.length) {
                            updateFileTest();
                        }
                    })
                    .catch(error => {
                        html += `<div class="debug-info error">‚ùå ${file.name} - –æ—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${error.message}</div>`;
                        if (successCount === files.length) {
                            updateFileTest();
                        }
                    });
            });
            
            function updateFileTest() {
                fileTest.innerHTML = html;
                fileTest.parentElement.className = `debug-section ${successCount === files.length ? 'success' : 'error'}`;
            }
        }
        
        // –¢–µ—Å—Ç —Ñ—É–Ω–∫—Ü–∏–π
        function testFunctions() {
            const functionTest = document.getElementById('functionTest');
            let html = '<h4>–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ—É–Ω–∫—Ü–∏–π:</h4>';
            
            const functions = [
                'switchTab',
                'showTabContent',
                'hideAllSections',
                'showHomeContent',
                'showSearchContent',
                'showFavoritesContent',
                'showProfileContent',
                'searchPurchases',
                'performSearch',
                'addToFavorites'
            ];
            
            let successCount = 0;
            functions.forEach(funcName => {
                if (typeof window[funcName] === 'function') {
                    html += `<div class="debug-info success">‚úÖ ${funcName} - –Ω–∞–π–¥–µ–Ω–∞</div>`;
                    successCount++;
                } else {
                    html += `<div class="debug-info error">‚ùå ${funcName} - –Ω–µ –Ω–∞–π–¥–µ–Ω–∞</div>`;
                }
            });
            
            html += `<div class="debug-info ${successCount === functions.length ? 'success' : 'error'}">`;
            html += `üìä –†–µ–∑—É–ª—å—Ç–∞—Ç: ${successCount}/${functions.length} —Ñ—É–Ω–∫—Ü–∏–π –Ω–∞–π–¥–µ–Ω–æ`;
            html += '</div>';
            
            functionTest.innerHTML = html;
            functionTest.parentElement.className = `debug-section ${successCount === functions.length ? 'success' : 'error'}`;
        }
        
        // –¢–µ—Å—Ç –ø–æ–∏—Å–∫–∞
        function testSearch() {
            const searchTest = document.getElementById('searchTest');
            let html = '<h4>–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–∏—Å–∫–∞:</h4>';
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –¥–∞–Ω–Ω—ã—Ö
            if (typeof mockPurchases !== 'undefined') {
                html += `<div class="debug-info success">‚úÖ mockPurchases –Ω–∞–π–¥–µ–Ω—ã (${mockPurchases.length} –∑–∞–∫—É–ø–æ–∫)</div>`;
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–∏—Å–∫
                if (typeof searchPurchases === 'function') {
                    try {
                        const results = searchPurchases('–∫—Ä–∞—Å–∫–∞', {});
                        html += `<div class="debug-info success">‚úÖ –ü–æ–∏—Å–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–∞–π–¥–µ–Ω–æ: ${results.length} —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤</div>`;
                    } catch (error) {
                        html += `<div class="debug-info error">‚ùå –û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞: ${error.message}</div>`;
                    }
                } else {
                    html += `<div class="debug-info error">‚ùå –§—É–Ω–∫—Ü–∏—è searchPurchases –Ω–µ –Ω–∞–π–¥–µ–Ω–∞</div>`;
                }
            } else {
                html += `<div class="debug-info error">‚ùå mockPurchases –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>`;
            }
            
            searchTest.innerHTML = html;
        }
        
        // –¢–µ—Å—Ç –≤–∫–ª–∞–¥–æ–∫
        function testTabs() {
            const tabTest = document.getElementById('tabTest');
            let html = '<h4>–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∫–ª–∞–¥–æ–∫:</h4>';
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
            const navItems = document.querySelectorAll('.nav-item');
            if (navItems.length > 0) {
                html += `<div class="debug-info success">‚úÖ –ù–∞–π–¥–µ–Ω–æ ${navItems.length} —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏</div>`;
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
                navItems.forEach((item, index) => {
                    const tab = item.dataset.tab;
                    html += `<div class="debug-info">üìç –í–∫–ª–∞–¥–∫–∞ ${index + 1}: ${tab}</div>`;
                });
            } else {
                html += `<div class="debug-info error">‚ùå –≠–ª–µ–º–µ–Ω—Ç—ã –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>`;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ —Å–µ–∫—Ü–∏–∏
            const sections = ['main-menu', 'quick-actions', 'recent-purchases'];
            sections.forEach(section => {
                const element = document.querySelector(`.${section}`);
                if (element) {
                    html += `<div class="debug-info success">‚úÖ –°–µ–∫—Ü–∏—è ${section} –Ω–∞–π–¥–µ–Ω–∞</div>`;
                } else {
                    html += `<div class="debug-info error">‚ùå –°–µ–∫—Ü–∏—è ${section} –Ω–µ –Ω–∞–π–¥–µ–Ω–∞</div>`;
                }
            });
            
            tabTest.innerHTML = html;
        }
        
        // –¢–µ—Å—Ç Telegram Web App
        function testTelegram() {
            const telegramTest = document.getElementById('telegramTest');
            let html = '<h4>–ü—Ä–æ–≤–µ—Ä–∫–∞ Telegram Web App:</h4>';
            
            if (typeof Telegram !== 'undefined' && Telegram.WebApp) {
                html += `<div class="debug-info success">‚úÖ Telegram Web App API –¥–æ—Å—Ç—É–ø–µ–Ω</div>`;
                
                try {
                    const tg = Telegram.WebApp;
                    html += `<div class="debug-info">üì± –í–µ—Ä—Å–∏—è: ${tg.version}</div>`;
                    html += `<div class="debug-info">üåê –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞: ${tg.platform}</div>`;
                    html += `<div class="debug-info">üìè –†–∞–∑–º–µ—Ä: ${tg.viewportHeight}x${tg.viewportWidth}</div>`;
                    
                    if (tg.initData) {
                        html += `<div class="debug-info success">‚úÖ –î–∞–Ω–Ω—ã–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–æ–ª—É—á–µ–Ω—ã</div>`;
                    } else {
                        html += `<div class="debug-info warning">‚ö†Ô∏è –î–∞–Ω–Ω—ã–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –Ω–µ –ø–æ–ª—É—á–µ–Ω—ã</div>`;
                    }
                } catch (error) {
                    html += `<div class="debug-info error">‚ùå –û—à–∏–±–∫–∞ Telegram API: ${error.message}</div>`;
                }
            } else {
                html += `<div class="debug-info error">‚ùå Telegram Web App API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω</div>`;
            }
            
            telegramTest.innerHTML = html;
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—à–∏–±–æ–∫ –∫–æ–Ω—Å–æ–ª–∏
        function checkConsoleErrors() {
            const consoleErrorsDiv = document.getElementById('consoleErrors');
            let html = '<h4>–û—à–∏–±–∫–∏ –∫–æ–Ω—Å–æ–ª–∏:</h4>';
            
            if (consoleErrors.length === 0) {
                html += '<div class="debug-info success">‚úÖ –û—à–∏–±–æ–∫ –≤ –∫–æ–Ω—Å–æ–ª–∏ –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ</div>';
            } else {
                consoleErrors.forEach((error, index) => {
                    html += `<div class="debug-info ${error.type === 'error' ? 'error' : 'warning'}">`;
                    html += `${error.type === 'error' ? '‚ùå' : '‚ö†Ô∏è'} ${error.timestamp}: `;
                    html += error.args.map(arg => String(arg)).join(' ');
                    html += '</div>';
                });
            }
            
            consoleErrorsDiv.innerHTML = html;
        }
        
        // –¢–µ—Å—Ç –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –≤–∫–ª–∞–¥–æ–∫
        function testTab(tabName) {
            console.log('–¢–µ—Å—Ç–∏—Ä—É–µ–º –≤–∫–ª–∞–¥–∫—É:', tabName);
            
            if (typeof switchTab === 'function') {
                try {
                    switchTab(tabName);
                    console.log('‚úÖ –í–∫–ª–∞–¥–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ');
                } catch (error) {
                    console.error('‚ùå –û—à–∏–±–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –≤–∫–ª–∞–¥–∫–∏:', error);
                }
            } else {
                console.error('‚ùå –§—É–Ω–∫—Ü–∏—è switchTab –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤
        document.addEventListener('DOMContentLoaded', function() {
            console.log('–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∑–∞–ø—É—â–µ–Ω–∞');
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç—ã —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π
            setTimeout(() => {
                testFileLoading();
                testFunctions();
                testSearch();
                testTabs();
                testTelegram();
                checkConsoleErrors();
            }, 1000);
        });
    </script>
</body>
</html>
